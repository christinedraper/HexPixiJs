(function(){var i=this,n=n||{},t;n.WEBGL_RENDERER=0,n.CANVAS_RENDERER=1,n.VERSION="v2.2.5",n.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},n.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},n._UID=0,"undefined"!=typeof Float32Array?(n.Float32Array=Float32Array,n.Uint16Array=Uint16Array,n.Uint32Array=Uint32Array,n.ArrayBuffer=ArrayBuffer):(n.Float32Array=Array,n.Uint16Array=Array),n.INTERACTION_FREQUENCY=30,n.AUTO_PREVENT_DEFAULT=!0,n.PI_2=2*Math.PI,n.RAD_TO_DEG=180/Math.PI,n.DEG_TO_RAD=Math.PI/180,n.RETINA_PREFIX="@2x",n.dontSayHello=!1,n.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},n.sayHello=function(t){if(!n.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+n.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+n.VERSION+" - http://www.pixijs.com/");n.dontSayHello=!0}},n.Point=function(n,t){this.x=n||0,this.y=t||0},n.Point.prototype.clone=function(){return new n.Point(this.x,this.y)},n.Point.prototype.set=function(n,t){this.x=n||0,this.y=t||(0!==t?this.x:0)},n.Point.prototype.constructor=n.Point,n.Rectangle=function(n,t,i,r){this.x=n||0,this.y=t||0,this.width=i||0,this.height=r||0},n.Rectangle.prototype.clone=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)},n.Rectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1},n.Rectangle.prototype.constructor=n.Rectangle,n.EmptyRectangle=new n.Rectangle(0,0,0,0),n.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof n.Point){for(var r=[],i=0,u=t.length;u>i;i++)r.push(t[i].x,t[i].y);t=r}this.closed=!0,this.points=t},n.Polygon.prototype.clone=function(){var t=this.points.slice();return new n.Polygon(t)},n.Polygon.prototype.contains=function(n,t){for(var r=!1,e=this.points.length/2,i=0,u=e-1;e>i;u=i++){var o=this.points[2*i],f=this.points[2*i+1],h=this.points[2*u],s=this.points[2*u+1],c=f>t!=s>t&&(h-o)*(t-f)/(s-f)+o>n;c&&(r=!r)}return r},n.Polygon.prototype.constructor=n.Polygon,n.Circle=function(n,t,i){this.x=n||0,this.y=t||0,this.radius=i||0},n.Circle.prototype.clone=function(){return new n.Circle(this.x,this.y,this.radius)},n.Circle.prototype.contains=function(n,t){if(this.radius<=0)return!1;var i=this.x-n,r=this.y-t,u=this.radius*this.radius;return i*=i,r*=r,u>=i+r},n.Circle.prototype.getBounds=function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},n.Circle.prototype.constructor=n.Circle,n.Ellipse=function(n,t,i,r){this.x=n||0,this.y=t||0,this.width=i||0,this.height=r||0},n.Ellipse.prototype.clone=function(){return new n.Ellipse(this.x,this.y,this.width,this.height)},n.Ellipse.prototype.contains=function(n,t){if(this.width<=0||this.height<=0)return!1;var i=(n-this.x)/this.width,r=(t-this.y)/this.height;return i*=i,r*=r,1>=i+r},n.Ellipse.prototype.getBounds=function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},n.Ellipse.prototype.constructor=n.Ellipse,n.RoundedRectangle=function(n,t,i,r,u){this.x=n||0,this.y=t||0,this.width=i||0,this.height=r||0,this.radius=u||20},n.RoundedRectangle.prototype.clone=function(){return new n.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},n.RoundedRectangle.prototype.contains=function(n,t){var i,r;return this.width<=0||this.height<=0?!1:(i=this.x,n>=i&&n<=i+this.width&&(r=this.y,t>=r&&t<=r+this.height))?!0:!1},n.RoundedRectangle.prototype.constructor=n.RoundedRectangle,n.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},n.Matrix.prototype.fromArray=function(n){this.a=n[0],this.b=n[1],this.c=n[3],this.d=n[4],this.tx=n[2],this.ty=n[5]},n.Matrix.prototype.toArray=function(t){this.array||(this.array=new n.Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},n.Matrix.prototype.apply=function(t,i){return i=i||new n.Point,i.x=this.a*t.x+this.c*t.y+this.tx,i.y=this.b*t.x+this.d*t.y+this.ty,i},n.Matrix.prototype.applyInverse=function(t,i){i=i||new n.Point;var r=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*r*t.x+-this.c*r*t.y+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*t.y+-this.b*r*t.x+(-this.ty*this.a+this.tx*this.b)*r,i},n.Matrix.prototype.translate=function(n,t){return this.tx+=n,this.ty+=t,this},n.Matrix.prototype.scale=function(n,t){return this.a*=n,this.d*=t,this.c*=n,this.b*=t,this.tx*=n,this.ty*=t,this},n.Matrix.prototype.rotate=function(n){var t=Math.cos(n),i=Math.sin(n),r=this.a,u=this.c,f=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=u*t-this.d*i,this.d=u*i+this.d*t,this.tx=f*t-this.ty*i,this.ty=f*i+this.ty*t,this},n.Matrix.prototype.append=function(n){var t=this.a,i=this.b,r=this.c,u=this.d;return this.a=n.a*t+n.b*r,this.b=n.a*i+n.b*u,this.c=n.c*t+n.d*r,this.d=n.c*i+n.d*u,this.tx=n.tx*t+n.ty*r+this.tx,this.ty=n.tx*i+n.ty*u+this.ty,this},n.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.identityMatrix=new n.Matrix,n.DisplayObject=function(){this.position=new n.Point,this.scale=new n.Point(1,1),this.pivot=new n.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new n.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new n.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},n.DisplayObject.prototype.constructor=n.DisplayObject,Object.defineProperty(n.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(n){this._interactive=n,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"worldVisible",{get:function(){var n=this;do{if(!n.visible)return!1;n=n.parent}while(n);return!0}}),Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask&&(this._mask.isMask=!1),this._mask=n,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(n){var r,t,u,i;if(n){for(r=[],t=0;t<n.length;t++)for(u=n[t].passes,i=0;i<u.length;i++)r.push(u[i]);this._filterBlock={target:this,filterPasses:r}}this._filters=n}}),Object.defineProperty(n.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap!==n&&(n?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=n)}}),n.DisplayObject.prototype.updateTransform=function(){var r,o,s,u,f,e,t=this.parent.worldTransform,i=this.worldTransform;this.rotation%n.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),r=this._cr*this.scale.x,o=this._sr*this.scale.x,s=-this._sr*this.scale.y,u=this._cr*this.scale.y,f=this.position.x,e=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*r+this.pivot.y*s,e-=this.pivot.x*o+this.pivot.y*u),i.a=r*t.a+o*t.c,i.b=r*t.b+o*t.d,i.c=s*t.a+u*t.c,i.d=s*t.b+u*t.d,i.tx=f*t.a+e*t.c+t.tx,i.ty=f*t.b+e*t.d+t.ty):(r=this.scale.x,u=this.scale.y,f=this.position.x-this.pivot.x*r,e=this.position.y-this.pivot.y*u,i.a=r*t.a,i.b=r*t.b,i.c=u*t.c,i.d=u*t.d,i.tx=f*t.a+e*t.c+t.tx,i.ty=f*t.b+e*t.d+t.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},n.DisplayObject.prototype.displayObjectUpdateTransform=n.DisplayObject.prototype.updateTransform,n.DisplayObject.prototype.getBounds=function(t){return t=t,n.EmptyRectangle},n.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(n.identityMatrix)},n.DisplayObject.prototype.setStageReference=function(n){this.stage=n,this._interactive&&(this.stage.dirty=!0)},n.DisplayObject.prototype.generateTexture=function(t,i,r){var u=this.getLocalBounds(),f=new n.RenderTexture(0|u.width,0|u.height,r,i,t);return n.DisplayObject._tempMatrix.tx=-u.x,n.DisplayObject._tempMatrix.ty=-u.y,f.render(this,n.DisplayObject._tempMatrix),f},n.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},n.DisplayObject.prototype.toGlobal=function(n){return this.displayObjectUpdateTransform(),this.worldTransform.apply(n)},n.DisplayObject.prototype.toLocal=function(n,t){return t&&(n=t.toGlobal(n)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(n)},n.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},n.DisplayObject.prototype._generateCachedSprite=function(){var t,r,i;this._cacheAsBitmap=!1,t=this.getLocalBounds(),this._cachedSprite?this._cachedSprite.texture.resize(0|t.width,0|t.height):(r=new n.RenderTexture(0|t.width,0|t.height),this._cachedSprite=new n.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform),i=this._filters,this._filters=null,this._cachedSprite.filters=i,n.DisplayObject._tempMatrix.tx=-t.x,n.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,n.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._filters=i,this._cacheAsBitmap=!0},n.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},n.DisplayObject.prototype._renderWebGL=function(n){n=n},n.DisplayObject.prototype._renderCanvas=function(n){n=n},n.DisplayObject._tempMatrix=new n.Matrix,Object.defineProperty(n.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}}),Object.defineProperty(n.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}}),n.DisplayObjectContainer=function(){n.DisplayObject.call(this),this.children=[]},n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype),n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer,Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(n){var t=this.getLocalBounds().width;this.scale.x=0!==t?n/t:1,this._width=n}}),Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(n){var t=this.getLocalBounds().height;this.scale.y=0!==t?n/t:1,this._height=n}}),n.DisplayObjectContainer.prototype.addChild=function(n){return this.addChildAt(n,this.children.length)},n.DisplayObjectContainer.prototype.addChildAt=function(n,t){if(t>=0&&t<=this.children.length)return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),this.stage&&n.setStageReference(this.stage),n;throw new Error(n+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);},n.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.getChildIndex(n),r=this.getChildIndex(t);if(0>i||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t,this.children[r]=n}},n.DisplayObjectContainer.prototype.getChildIndex=function(n){var t=this.children.indexOf(n);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},n.DisplayObjectContainer.prototype.setChildIndex=function(n,t){if(0>t||t>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(n);this.children.splice(i,1),this.children.splice(t,0,n)},n.DisplayObjectContainer.prototype.getChildAt=function(n){if(0>n||n>=this.children.length)throw new Error("getChildAt: Supplied index "+n+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[n]},n.DisplayObjectContainer.prototype.removeChild=function(n){var t=this.children.indexOf(n);if(-1!==t)return this.removeChildAt(t)},n.DisplayObjectContainer.prototype.removeChildAt=function(n){var t=this.getChildAt(n);return this.stage&&t.removeStageReference(),t.parent=void 0,this.children.splice(n,1),t},n.DisplayObjectContainer.prototype.removeChildren=function(n,t){var e=n||0,o="number"==typeof t?t:this.children.length,i=o-e,r,u,f;if(i>0&&o>=i){for(r=this.children.splice(e,i),u=0;u<r.length;u++)f=r[u],this.stage&&f.removeStageReference(),f.parent=void 0;return r}if(0===i&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range");},n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var n=0,t=this.children.length;t>n;n++)this.children[n].updateTransform()},n.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=n.DisplayObjectContainer.prototype.updateTransform,n.DisplayObjectContainer.prototype.getBounds=function(){var l,i;if(0===this.children.length)return n.EmptyRectangle;for(var t,s,h,r=1/0,u=1/0,f=-1/0,e=-1/0,c=!1,o=0,a=this.children.length;a>o;o++)l=this.children[o],l.visible&&(c=!0,t=this.children[o].getBounds(),r=r<t.x?r:t.x,u=u<t.y?u:t.y,s=t.width+t.x,h=t.height+t.y,f=f>s?f:s,e=e>h?e:h);return c?(i=this._bounds,i.x=r,i.y=u,i.width=f-r,i.height=e-u,i):n.EmptyRectangle},n.DisplayObjectContainer.prototype.getLocalBounds=function(){var u=this.worldTransform,t,i,r;for(this.worldTransform=n.identityMatrix,t=0,i=this.children.length;i>t;t++)this.children[t].updateTransform();return r=this.getBounds(),this.worldTransform=u,r},n.DisplayObjectContainer.prototype.setStageReference=function(n){var t,i,r;for(this.stage=n,this._interactive&&(this.stage.dirty=!0),t=0,i=this.children.length;i>t;t++)r=this.children[t],r.setStageReference(n)},n.DisplayObjectContainer.prototype.removeStageReference=function(){for(var i,n=0,t=this.children.length;t>n;n++)i=this.children[n],i.removeStageReference();this._interactive&&(this.stage.dirty=!0),this.stage=null},n.DisplayObjectContainer.prototype._renderWebGL=function(n){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(n);var t,i;if(this._mask||this._filters){for(this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop(),this._mask&&n.maskManager.popMask(this._mask,n),this._filters&&n.filterManager.popFilter(),n.spriteBatch.start()}else for(t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n)}},n.DisplayObjectContainer.prototype._renderCanvas=function(n){var t,i,r;if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(n);for(this._mask&&n.maskManager.pushMask(this._mask,n),t=0,i=this.children.length;i>t;t++)r=this.children[t],r._renderCanvas(n);this._mask&&n.maskManager.popMask(n)}},n.Sprite=function(t){n.DisplayObjectContainer.call(this),this.anchor=new n.Point,this.texture=t||n.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=n.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Sprite.prototype.constructor=n.Sprite,Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width,this._width=n}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height,this._height=n}}),n.Sprite.prototype.setTexture=function(n){this.texture=n,this.cachedTint=16777215},n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},n.Sprite.prototype.getBounds=function(n){var ft=this.texture.frame.width,ut=this.texture.frame.height,l=ft*(1-this.anchor.x),a=ft*-this.anchor.x,y=ut*(1-this.anchor.y),v=ut*-this.anchor.y,h=n||this.worldTransform,e=h.a,w=h.b,p=h.c,f=h.d,c=h.tx,s=h.ty,u=-1/0,r=-1/0,i=1/0,t=1/0,o;if(0===w&&0===p)0>e&&(e*=-1),0>f&&(f*=-1),i=e*a+c,u=e*l+c,t=f*v+s,r=f*y+s;else{var b=e*a+p*v+c,k=f*v+w*a+s,d=e*l+p*v+c,g=f*v+w*l+s,nt=e*l+p*y+c,tt=f*y+w*l+s,it=e*a+p*y+c,rt=f*y+w*a+s;i=i>b?b:i,i=i>d?d:i,i=i>nt?nt:i,i=i>it?it:i,t=t>k?k:t,t=t>g?g:t,t=t>tt?tt:t,t=t>rt?rt:t,u=b>u?b:u,u=d>u?d:u,u=nt>u?nt:u,u=it>u?it:u,r=k>r?k:r,r=g>r?g:r,r=tt>r?tt:r,r=rt>r?rt:r}return o=this._bounds,o.x=i,o.width=u-i,o.y=t,o.height=r-t,this._currentBounds=o,o},n.Sprite.prototype._renderWebGL=function(n){var t,r,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){for(i=n.spriteBatch,this._filters&&(i.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),n.maskManager.pushMask(this.mask,n),i.start()),i.render(this),t=0,r=this.children.length;r>t;t++)this.children[t]._renderWebGL(n);i.stop(),this._mask&&n.maskManager.popMask(this._mask,n),this._filters&&n.filterManager.popFilter(),i.start()}else for(n.spriteBatch.render(this),t=0,r=this.children.length;r>t;t++)this.children[t]._renderWebGL(n)},n.Sprite.prototype._renderCanvas=function(t){var i,r,u,f,e;if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){for((this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid)&&(i=this.texture.baseTexture.resolution/t.resolution,t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR),r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,u=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),r=0|r,u=0|u):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/i,u/i,this.texture.crop.width/i,this.texture.crop.height/i)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/i,u/i,this.texture.crop.width/i,this.texture.crop.height/i)),f=0,e=this.children.length;e>f;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},n.Sprite.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new n.Sprite(i)},n.Sprite.fromImage=function(t,i,r){var u=n.Texture.fromImage(t,i,r);return new n.Sprite(u)},n.SpriteBatch=function(t){n.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},n.SpriteBatch.prototype=Object.create(n.DisplayObjectContainer.prototype),n.SpriteBatch.prototype.constructor=n.SpriteBatch,n.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new n.WebGLFastSpriteBatch(t),this.ready=!0},n.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},n.SpriteBatch.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(n.gl),n.spriteBatch.stop(),n.shaderManager.setShader(n.shaderManager.fastShader),this.fastSpriteBatch.begin(this,n),this.fastSpriteBatch.render(this),n.spriteBatch.start())},n.SpriteBatch.prototype._renderCanvas=function(n){var u,t,o,i,r;if(this.visible&&!(this.alpha<=0)&&this.children.length){u=n.context,u.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var f=this.worldTransform,e=!0,s=0;s<this.children.length;s++)t=this.children[s],t.visible&&(o=t.texture,i=o.frame,(u.globalAlpha=this.worldAlpha*t.alpha,t.rotation%(2*Math.PI)==0)?(e&&(u.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),e=!1),u.drawImage(o.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width*t.scale.x+t.position.x+.5|0,t.anchor.y*-i.height*t.scale.y+t.position.y+.5|0,i.width*t.scale.x,i.height*t.scale.y)):(e||(e=!0),t.displayObjectUpdateTransform(),r=t.worldTransform,n.roundPixels?u.setTransform(r.a,r.b,r.c,r.d,0|r.tx,0|r.ty):u.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),u.drawImage(o.baseTexture.source,i.x,i.y,i.width,i.height,t.anchor.x*-i.width+.5|0,t.anchor.y*-i.height+.5|0,i.width,i.height)))}},n.MovieClip=function(t){n.Sprite.call(this,t[0]),this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},n.MovieClip.prototype=Object.create(n.Sprite.prototype),n.MovieClip.prototype.constructor=n.MovieClip,Object.defineProperty(n.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),n.MovieClip.prototype.stop=function(){this.playing=!1},n.MovieClip.prototype.play=function(){this.playing=!0},n.MovieClip.prototype.gotoAndStop=function(n){this.playing=!1,this.currentFrame=n;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},n.MovieClip.prototype.gotoAndPlay=function(n){this.currentFrame=n,this.playing=!0},n.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var n=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||n<this.textures.length?this.setTexture(this.textures[n%this.textures.length]):n>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},n.MovieClip.fromFrames=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Texture.fromFrame(t[i]));return new n.MovieClip(r)},n.MovieClip.fromImages=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Texture.fromImage(t[i]));return new n.MovieClip(r)},n.FilterBlock=function(){this.visible=!0,this.renderable=!0},n.FilterBlock.prototype.constructor=n.FilterBlock,n.Text=function(t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,n.Sprite.call(this,n.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(i)},n.Text.prototype=Object.create(n.Sprite.prototype),n.Text.prototype.constructor=n.Text,Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width,this._width=n}}),Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height,this._height=n}}),n.Text.prototype.setStyle=function(n){n=n||{},n.font=n.font||"bold 20pt Arial",n.fill=n.fill||"black",n.align=n.align||"left",n.stroke=n.stroke||"black",n.strokeThickness=n.strokeThickness||0,n.wordWrap=n.wordWrap||!1,n.wordWrapWidth=n.wordWrapWidth||100,n.dropShadow=n.dropShadow||!1,n.dropShadowAngle=n.dropShadowAngle||Math.PI/6,n.dropShadowDistance=n.dropShadowDistance||4,n.dropShadowColor=n.dropShadowColor||"black",this.style=n,this.dirty=!0},n.Text.prototype.setText=function(n){this.text=n.toString()||" ",this.dirty=!0},n.Text.prototype.updateText=function(){var o,h,c,e,l,t,f,a,v;this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font,o=this.text,this.style.wordWrap&&(o=this.wordWrap(this.text));for(var i=o.split(/(?:\r\n|\r|\n)/),u=[],r=0,s=this.determineFontProperties(this.style.font),n=0;n<i.length;n++)h=this.context.measureText(i[n]).width,u[n]=h,r=Math.max(r,h);if(c=r+this.style.strokeThickness,this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.width=(c+this.context.lineWidth)*this.resolution,e=s.fontSize+this.style.strokeThickness,l=e*i.length,this.style.dropShadow&&(l+=this.style.dropShadowDistance),this.canvas.height=l*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.style.dropShadow)for(this.context.fillStyle=this.style.dropShadowColor,a=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,v=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+s.ascent,"right"===this.style.align?t+=r-u[n]:"center"===this.style.align&&(t+=(r-u[n])/2),this.style.fill&&this.context.fillText(i[n],t+a,f+v);for(this.context.fillStyle=this.style.fill,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e+s.ascent,"right"===this.style.align?t+=r-u[n]:"center"===this.style.align&&(t+=(r-u[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],t,f),this.style.fill&&this.context.fillText(i[n],t,f);this.updateTexture()},n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},n.Text.prototype._renderWebGL=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),n.Sprite.prototype._renderWebGL.call(this,t)},n.Text.prototype._renderCanvas=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),n.Sprite.prototype._renderCanvas.call(this,t)},n.Text.prototype.determineFontProperties=function(t){var r=n.Text.fontPropertiesCache[t],a,i;if(!r){r={},a=n.Text.fontPropertiesCanvas,i=n.Text.fontPropertiesContext,i.font=t;var c=Math.ceil(i.measureText("|Mq").width),u=Math.ceil(i.measureText("M").width),l=2*u;u=1.4*u|0,a.width=c,a.height=l,i.fillStyle="#f00",i.fillRect(0,0,c,l),i.font=t,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|MÉq",0,u);for(var e,v=i.getImageData(0,0,c,l).data,y=v.length,o=4*c,s=0,h=!1,f=0;u>f;f++){for(e=0;o>e;e+=4)if(255!==v[s+e]){h=!0;break}if(h)break;s+=o}for(r.ascent=u-f,s=y-o,h=!1,f=l;f>u;f--){for(e=0;o>e;e+=4)if(255!==v[s+e]){h=!0;break}if(h)break;s-=o}r.descent=f-u,r.descent+=6,r.fontSize=r.ascent+r.descent,n.Text.fontPropertiesCache[t]=r}return r},n.Text.prototype.wordWrap=function(n){for(var o,s,i="",f=n.split("\n"),r=0;r<f.length;r++){for(var e=this.style.wordWrapWidth,u=f[r].split(" "),t=0;t<u.length;t++)o=this.context.measureText(u[t]).width,s=o+this.context.measureText(" ").width,0===t||s>e?(t>0&&(i+="\n"),i+=u[t],e=this.style.wordWrapWidth-o):(e-=s,i+=" "+u[t]);r<f.length-1&&(i+="\n")}return i},n.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),n.Sprite.prototype.getBounds.call(this,t)},n.Text.prototype.destroy=function(n){this.context=null,this.canvas=null,this.texture.destroy(void 0===n?!0:n)},n.Text.fontPropertiesCache={},n.Text.fontPropertiesCanvas=document.createElement("canvas"),n.Text.fontPropertiesContext=n.Text.fontPropertiesCanvas.getContext("2d"),n.BitmapText=function(t,i){n.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(t),this.setStyle(i),this.updateText(),this.dirty=!1},n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.BitmapText.prototype.setText=function(n){this.text=n||" ",this.dirty=!0},n.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):n.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=t.tint},n.BitmapText.prototype.updateText=function(){for(var a,u,y,h,r,p,c=n.BitmapText.fonts[this.fontName],i=new n.Point,o=null,f=[],e=0,l=[],v=0,s=this.fontSize/c.size,t=0;t<this.text.length;t++)a=this.text.charCodeAt(t),/(?:\r\n|\r|\n)/.test(this.text.charAt(t))?(l.push(i.x),e=Math.max(e,i.x),v++,i.x=0,i.y+=c.lineHeight,o=null):(u=c.chars[a],u&&(o&&u.kerning[o]&&(i.x+=u.kerning[o]),f.push({texture:u.texture,line:v,charCode:a,position:new n.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,o=a));for(l.push(i.x),e=Math.max(e,i.x),y=[],t=0;v>=t;t++)h=0,"right"===this.style.align?h=e-l[t]:"center"===this.style.align&&(h=(e-l[t])/2),y.push(h);var b=this.children.length,w=f.length,k=this.tint||16777215;for(t=0;w>t;t++)r=b>t?this.children[t]:this._pool.pop(),r?r.setTexture(f[t].texture):r=new n.Sprite(f[t].texture),r.position.x=(f[t].position.x+y[f[t].line])*s,r.position.y=f[t].position.y*s,r.scale.x=r.scale.y=s,r.tint=k,r.parent||this.addChild(r);for(;this.children.length>w;)p=this.getChildAt(this.children.length-1),this._pool.push(p),this.removeChild(p);this.textWidth=e*s,this.textHeight=(i.y+c.lineHeight)*s},n.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.BitmapText.fonts={},n.InteractionData=function(){this.global=new n.Point,this.target=null,this.originalEvent=null},n.InteractionData.prototype.getLocalPosition=function(t,i){var r=t.worldTransform,f=this.global,e=r.a,o=r.c,c=r.tx,s=r.b,h=r.d,l=r.ty,u=1/(e*h+o*-s);return i=i||new n.Point,i.x=h*u*f.x+-o*u*f.y+(l*o-c*h)*u,i.y=e*u*f.y+-s*u*f.x+(-l*e+c*s)*u,i},n.InteractionData.prototype.constructor=n.InteractionData,n.InteractionManager=function(t){this.stage=t,this.mouse=new n.InteractionData,this.touches={},this.tempPoint=new n.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new n.Point},n.InteractionManager.prototype.constructor=n.InteractionManager,n.InteractionManager.prototype.collectInteractiveSprite=function(n,t){for(var i,u=n.children,f=u.length,r=f-1;r>=0;r--)i=u[r],i._interactive?(t.interactiveChildren=!0,this.interactiveItems.push(i),i.children.length>0&&this.collectInteractiveSprite(i,i)):(i.__iParent=null,i.children.length>0&&this.collectInteractiveSprite(i,t))},n.InteractionManager.prototype.setTarget=function(n){this.target=n,this.resolution=n.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(n.view)},n.InteractionManager.prototype.setTargetDomElement=function(n){this.removeEvents(),window.navigator.msPointerEnabled&&(n.style["-ms-content-zooming"]="none",n.style["-ms-touch-action"]="none"),this.interactionDOMElement=n,n.addEventListener("mousemove",this.onMouseMove,!0),n.addEventListener("mousedown",this.onMouseDown,!0),n.addEventListener("mouseout",this.onMouseOut,!0),n.addEventListener("touchstart",this.onTouchStart,!0),n.addEventListener("touchend",this.onTouchEnd,!0),n.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},n.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},n.InteractionManager.prototype.update=function(){var f,r,i,t;if(this.target&&(f=Date.now(),r=f-this.last,r=r*n.INTERACTION_FREQUENCY/1e3,!(1>r))){this.last=f,i=0,this.dirty&&this.rebuildInteractiveGraph();var o=this.interactiveItems.length,u="inherit",e=!1;for(i=0;o>i;i++)t=this.interactiveItems[i],t.__hit=this.hitTest(t,this.mouse),this.mouse.target=t,t.__hit&&!e?(t.buttonMode&&(u=t.defaultCursor),t.interactiveChildren||(e=!0),t.__isOver||(t.mouseover&&t.mouseover(this.mouse),t.__isOver=!0)):t.__isOver&&(t.mouseout&&t.mouseout(this.mouse),t.__isOver=!1);this.currentCursorStyle!==u&&(this.currentCursorStyle=u,this.interactionDOMElement.style.cursor=u)}},n.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var t=this.interactiveItems.length,n=0;t>n;n++)this.interactiveItems[n].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},n.InteractionManager.prototype.onMouseMove=function(n){var t,u,i,r;for(this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n,t=this.interactionDOMElement.getBoundingClientRect(),this.mouse.global.x=(n.clientX-t.left)*(this.target.width/t.width)/this.resolution,this.mouse.global.y=(n.clientY-t.top)*(this.target.height/t.height)/this.resolution,u=this.interactiveItems.length,i=0;u>i;i++)r=this.interactiveItems[i],r.mousemove&&r.mousemove(this.mouse)},n.InteractionManager.prototype.onMouseDown=function(t){var i;this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=t,n.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var o=this.interactiveItems.length,e=this.mouse.originalEvent,r=2===e.button||3===e.which,u=r?"rightdown":"mousedown",s=r?"rightclick":"click",h=r?"__rightIsDown":"__mouseIsDown",c=r?"__isRightDown":"__isDown",f=0;o>f;f++)if(i=this.interactiveItems[f],(i[u]||i[s])&&(i[h]=!0,i.__hit=this.hitTest(i,this.mouse),i.__hit&&(i[u]&&i[u](this.mouse),i[c]=!0,!i.interactiveChildren)))break},n.InteractionManager.prototype.onMouseOut=function(n){var r,i,t;for(this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n,r=this.interactiveItems.length,this.interactionDOMElement.style.cursor="inherit",i=0;r>i;i++)t=this.interactiveItems[i],t.__isOver&&(this.mouse.target=t,t.mouseout&&t.mouseout(this.mouse),t.__isOver=!1);this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},n.InteractionManager.prototype.onMouseUp=function(n){var t;this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=n;for(var c=this.interactiveItems.length,s=!1,h=this.mouse.originalEvent,i=2===h.button||3===h.which,r=i?"rightup":"mouseup",u=i?"rightclick":"click",f=i?"rightupoutside":"mouseupoutside",e=i?"__isRightDown":"__isDown",o=0;c>o;o++)t=this.interactiveItems[o],(t[u]||t[r]||t[f])&&(t.__hit=this.hitTest(t,this.mouse),t.__hit&&!s?(t[r]&&t[r](this.mouse),t[e]&&t[u]&&t[u](this.mouse),t.interactiveChildren||(s=!0)):t[e]&&t[f]&&t[f](this.mouse),t[e]=!1)},n.InteractionManager.prototype.hitTest=function(t,i){var p=i.global,r,u,f,s,e,a,v,y;if(!t.worldVisible)return!1;if(t.worldTransform.applyInverse(p,this._tempPoint),u=this._tempPoint.x,f=this._tempPoint.y,i.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(u,f);if(t instanceof n.Sprite){var o,h=t.texture.frame.width,c=t.texture.frame.height,l=-h*t.anchor.x;if(u>l&&l+h>u&&(o=-c*t.anchor.y,f>o&&o+c>f))return!0}else if(t instanceof n.Graphics)for(s=t.graphicsData,r=0;r<s.length;r++)if(e=s[r],e.fill&&e.shape&&e.shape.contains(u,f))return!0;for(a=t.children.length,r=0;a>r;r++)if(v=t.children[r],y=this.hitTest(v,i),y)return i.target=t,!0;return!1},n.InteractionManager.prototype.onTouchMove=function(n){var i,e,u;this.dirty&&this.rebuildInteractiveGraph();for(var t,r=this.interactionDOMElement.getBoundingClientRect(),o=n.changedTouches,f=0,f=0;f<o.length;f++)for(i=o[f],t=this.touches[i.identifier],t.originalEvent=n,t.global.x=(i.clientX-r.left)*(this.target.width/r.width)/this.resolution,t.global.y=(i.clientY-r.top)*(this.target.height/r.height)/this.resolution,!navigator.isCocoonJS||r.left||r.top||n.target.style.width||n.target.style.height||(t.global.x=i.clientX,t.global.y=i.clientY),e=0;e<this.interactiveItems.length;e++)u=this.interactiveItems[e],u.touchmove&&u.__touchData&&u.__touchData[i.identifier]&&u.touchmove(t)},n.InteractionManager.prototype.onTouchStart=function(t){var u,s,e,f,r,h,o,i;for(this.dirty&&this.rebuildInteractiveGraph(),u=this.interactionDOMElement.getBoundingClientRect(),n.AUTO_PREVENT_DEFAULT&&t.preventDefault(),s=t.changedTouches,e=0;e<s.length;e++)for(f=s[e],r=this.pool.pop(),r||(r=new n.InteractionData),r.originalEvent=t,this.touches[f.identifier]=r,r.global.x=(f.clientX-u.left)*(this.target.width/u.width)/this.resolution,r.global.y=(f.clientY-u.top)*(this.target.height/u.height)/this.resolution,!navigator.isCocoonJS||u.left||u.top||t.target.style.width||t.target.style.height||(r.global.x=f.clientX,r.global.y=f.clientY),h=this.interactiveItems.length,o=0;h>o;o++)if(i=this.interactiveItems[o],(i.touchstart||i.tap)&&(i.__hit=this.hitTest(i,r),i.__hit&&(i.touchstart&&i.touchstart(r),i.__isDown=!0,i.__touchData=i.__touchData||{},i.__touchData[f.identifier]=r,!i.interactiveChildren)))break},n.InteractionManager.prototype.onTouchEnd=function(n){var h,f,t;this.dirty&&this.rebuildInteractiveGraph();for(var u=this.interactionDOMElement.getBoundingClientRect(),o=n.changedTouches,e=0;e<o.length;e++){var i=o[e],r=this.touches[i.identifier],s=!1;for(r.global.x=(i.clientX-u.left)*(this.target.width/u.width)/this.resolution,r.global.y=(i.clientY-u.top)*(this.target.height/u.height)/this.resolution,!navigator.isCocoonJS||u.left||u.top||n.target.style.width||n.target.style.height||(r.global.x=i.clientX,r.global.y=i.clientY),h=this.interactiveItems.length,f=0;h>f;f++)t=this.interactiveItems[f],t.__touchData&&t.__touchData[i.identifier]&&(t.__hit=this.hitTest(t,t.__touchData[i.identifier]),r.originalEvent=n,(t.touchend||t.tap)&&(t.__hit&&!s?(t.touchend&&t.touchend(r),t.__isDown&&t.tap&&t.tap(r),t.interactiveChildren||(s=!0)):t.__isDown&&t.touchendoutside&&t.touchendoutside(r),t.__isDown=!1),t.__touchData[i.identifier]=null);this.pool.push(r),this.touches[i.identifier]=null}},n.Stage=function(t){n.DisplayObjectContainer.call(this),this.worldTransform=new n.Matrix,this.interactive=!0,this.interactionManager=new n.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new n.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t)},n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Stage.prototype.constructor=n.Stage,n.Stage.prototype.setInteractionDelegate=function(n){this.interactionManager.setTargetDomElement(n)},n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0,t=this.children.length;t>n;n++)this.children[n].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},n.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=n.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},n.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(n){for(var r=0,i=["ms","moz","webkit","o"],t=0;t<i.length&&!n.requestAnimationFrame;++t)n.requestAnimationFrame=n[i[t]+"RequestAnimationFrame"],n.cancelAnimationFrame=n[i[t]+"CancelAnimationFrame"]||n[i[t]+"CancelRequestAnimationFrame"];n.requestAnimationFrame||(n.requestAnimationFrame=function(t){var i=+new Date,u=Math.max(0,16-(i-r)),f=n.setTimeout(function(){t(i+u)},u);return r=i+u,f}),n.cancelAnimationFrame||(n.cancelAnimationFrame=function(n){clearTimeout(n)}),n.requestAnimFrame=n.requestAnimationFrame}(this),n.hex2rgb=function(n){return[(n>>16&255)/255,(n>>8&255)/255,(255&n)/255]},n.rgb2hex=function(n){return(255*n[0]<<16)+(255*n[1]<<8)+255*n[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(n){function i(){for(var t=arguments.length,f=new Array(t);t--;)f[t]=arguments[t];return f=u.concat(f),r.apply(this instanceof i?this:n,f)}var r=this,t=arguments.length-1,u=[];if(t>0)for(u.length=t;t--;)u[t]=arguments[t+1];if("function"!=typeof r)throw new TypeError;return i.prototype=function f(n){return n&&(f.prototype=n),this instanceof f?void 0:new f}(r.prototype),i}}()),n.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],n;if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(n=0;n<t.length;n++)try{return new window.ActiveXObject(t[n])}catch(i){}},n.canUseNewCanvasBlendModes=function(){var t,n;return"undefined"==typeof document?!1:(t=document.createElement("canvas"),t.width=1,t.height=1,n=t.getContext("2d"),n.fillStyle="#000",n.fillRect(0,0,1,1),n.globalCompositeOperation="multiply",n.fillStyle="#fff",n.fillRect(0,0,1,1),0===n.getImageData(0,0,1,1).data[0])},n.getNextPowerOfTwo=function(n){if(n>0&&0==(n&n-1))return n;for(var t=1;n>t;)t<<=1;return t},n.isPowerOfTwo=function(n,t){return n>0&&0==(n&n-1)&&t>0&&0==(t&t-1)},n.EventTarget={call:function(t){t&&(t=t.prototype||t,n.EventTarget.mixin(t))},mixin:function(t){t.listeners=function(n){return this._listeners=this._listeners||{},this._listeners[n]?this._listeners[n].slice():[]},t.emit=t.dispatchEvent=function(t,i){if(this._listeners=this._listeners||{},"object"==typeof t&&(i=t,t=t.type),i&&i.__isEventObject===!0||(i=new n.Event(this,t,i)),this._listeners&&this._listeners[t]){for(var u=this._listeners[t].slice(0),e=u.length,f=u[0],r=0;e>r;f=u[++r])if(f.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,t,i),this},t.on=t.addEventListener=function(n,t){return this._listeners=this._listeners||{},(this._listeners[n]=this._listeners[n]||[]).push(t),this},t.once=function(n,t){function i(){t.apply(r.off(n,i),arguments)}this._listeners=this._listeners||{};var r=this;return i._originalHandler=t,this.on(n,i)},t.off=t.removeEventListener=function(n,t){if(this._listeners=this._listeners||{},!this._listeners[n])return this;for(var i=this._listeners[n],r=t?i.length:0;r-->0;)(i[r]===t||i[r]._originalHandler===t)&&i.splice(r,1);return 0===i.length&&delete this._listeners[n],this},t.removeAllListeners=function(n){return this._listeners=this._listeners||{},this._listeners[n]?(delete this._listeners[n],this):this}}},n.Event=function(n,t,i){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=n,this.type=t,this.data=i,this.content=i,this.timeStamp=Date.now()},n.Event.prototype.stopPropagation=function(){this.stopped=!0},n.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},n.autoDetectRenderer=function(t,i,r){t||(t=800),i||(i=600);var u=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}();return u?new n.WebGLRenderer(t,i,r):new n.CanvasRenderer(t,i,r)},n.autoDetectRecommendedRenderer=function(t,i,r){t||(t=800),i||(i=600);var u=function(){try{var n=document.createElement("canvas");return!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}(),f=/Android/i.test(navigator.userAgent);return u&&!f?new n.WebGLRenderer(t,i,r):new n.CanvasRenderer(t,i,r)},n.PolyK={},n.PolyK.Triangulate=function(t){var a=!0,e=t.length>>1,u,h,f;if(3>e)return[];for(var c=[],r=[],i=0;e>i;i++)r.push(i);for(i=0,u=e;u>3;){var o=r[(i+0)%u],s=r[(i+1)%u],l=r[(i+2)%u],y=t[2*o],p=t[2*o+1],w=t[2*s],b=t[2*s+1],k=t[2*l],d=t[2*l+1],v=!1;if(n.PolyK._convex(y,p,w,b,k,d,a))for(v=!0,h=0;u>h;h++)if(f=r[h],f!==o&&f!==s&&f!==l&&n.PolyK._PointInTriangle(t[2*f],t[2*f+1],y,p,w,b,k,d)){v=!1;break}if(v)c.push(o,s,l),r.splice((i+1)%u,1),u--,i=0;else if(i++>3*u){if(!a)return null;for(c=[],r=[],i=0;e>i;i++)r.push(i);i=0,u=e,a=!1}}return c.push(r[0],r[1],r[2]),c},n.PolyK._PointInTriangle=function(n,t,i,r,u,f,e,o){var a=e-i,l=o-r,c=u-i,h=f-r,v=n-i,y=t-r,p=a*a+l*l,s=a*c+l*h,w=a*v+l*y,b=c*c+h*h,k=c*v+h*y,d=1/(p*b-s*s),g=(b*w-s*k)*d,nt=(p*k-s*w)*d;return g>=0&&nt>=0&&1>g+nt},n.PolyK._convex=function(n,t,i,r,u,f,e){return(t-r)*(u-i)+(i-n)*(f-r)>=0===e},n.initDefaultShaders=function(){},n.CompileVertexShader=function(t,i){return n._CompileShader(t,i,t.VERTEX_SHADER)},n.CompileFragmentShader=function(t,i){return n._CompileShader(t,i,t.FRAGMENT_SHADER)},n._CompileShader=function(n,t,i){var u=t.join("\n"),r=n.createShader(i);return n.shaderSource(r,u),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(window.console.log(n.getShaderInfoLog(r)),null)},n.compileProgram=function(t,i,r){var f=n.CompileFragmentShader(t,r),e=n.CompileVertexShader(t,i),u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,f),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),u},n.PixiShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},n.PixiShader.prototype.constructor=n.PixiShader,n.PixiShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc),r;t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms(),this.program=i},n.PixiShader.prototype.initUniforms=function(){var t,i,r,n;this.textureCount=1,i=this.gl;for(r in this.uniforms)t=this.uniforms[r],n=t.type,"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=i.uniformMatrix2fv:"mat3"===n?t.glFunc=i.uniformMatrix3fv:"mat4"===n&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength="2f"===n||"2i"===n?2:"3f"===n||"3i"===n?3:"4f"===n||"4i"===n?4:1)},n.PixiShader.prototype.initSampler2D=function(n){var t;if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t=this.gl,t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,n.value.baseTexture._glTextures[t.id]),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.LINEAR,o=i.minFilter?i.minFilter:t.LINEAR,u=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,r=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(u=t.REPEAT,f=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,r,s,h,c,r,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,r,t.RGBA,t.UNSIGNED_BYTE,n.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,f)}t.uniform1i(n.uniformLocation,this.textureCount),n._init=!0,this.textureCount++}},n.PixiShader.prototype.syncUniforms=function(){var t,i,r;this.textureCount=1,i=this.gl;for(r in this.uniforms)t=this.uniforms[r],1===t.glValueLength?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?n.instances[i.id].updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],n.PixiFastShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},n.PixiFastShader.prototype.constructor=n.PixiFastShader,n.PixiFastShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.uMatrix=t.getUniformLocation(i,"uMatrix"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord"),this.aScale=t.getAttribLocation(i,"aScale"),this.aRotation=t.getAttribLocation(i,"aRotation"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.StripShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},n.StripShader.prototype.constructor=n.StripShader,n.StripShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},n.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},n.PrimitiveShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},n.PrimitiveShader.prototype.constructor=n.PrimitiveShader,n.PrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},n.ComplexPrimitiveShader=function(t){this._UID=n._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},n.ComplexPrimitiveShader.prototype.constructor=n.ComplexPrimitiveShader,n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.color=t.getUniformLocation(i,"color"),this.flipY=t.getUniformLocation(i,"flipY"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},n.WebGLGraphics=function(){},n.WebGLGraphics.renderGraphics=function(t,i){var f,r=i.gl,s=i.projection,h=i.offset,u=i.shaderManager.primitiveShader,o,e;for(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),o=t._webGL[r.id],e=0;e<o.data.length;e++)1===o.data[e].mode?(f=o.data[e],i.stencilManager.pushStencil(t,f,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(f.indices.length-4)),i.stencilManager.popStencil(t,f,i)):(f=o.data[e],i.shaderManager.setShader(u),u=i.shaderManager.primitiveShader,r.uniformMatrix3fv(u.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(u.flipY,1),r.uniform2f(u.projectionVector,s.x,-s.y),r.uniform2f(u.offsetVector,-h.x,-h.y),r.uniform3fv(u.tintColor,n.hex2rgb(t.tint)),r.uniform1f(u.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,f.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(u.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,f.indices.length,r.UNSIGNED_SHORT,0))},n.WebGLGraphics.updateGraphics=function(t,i){var u=t._webGL[i.id],e,o,f,r,s;if(u||(u=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<u.data.length;e++)o=u.data[e],o.reset(),n.WebGLGraphics.graphicsDataPool.push(o);u.data=[],u.lastIndex=0}for(e=u.lastIndex;e<t.graphicsData.length;e++)r=t.graphicsData[e],r.type===n.Graphics.POLY?((r.points=r.shape.points.slice(),r.shape.closed&&(r.points[0]!==r.points[r.points.length-2]||r.points[1]!==r.points[r.points.length-1])&&r.points.push(r.points[0],r.points[1]),r.fill&&r.points.length>=6)&&(r.points.length<12?(f=n.WebGLGraphics.switchMode(u,0),s=n.WebGLGraphics.buildPoly(r,f),s||(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f))):(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f))),r.lineWidth>0&&(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildLine(r,f))):(f=n.WebGLGraphics.switchMode(u,0),r.type===n.Graphics.RECT?n.WebGLGraphics.buildRectangle(r,f):r.type===n.Graphics.CIRC||r.type===n.Graphics.ELIP?n.WebGLGraphics.buildCircle(r,f):r.type===n.Graphics.RREC&&n.WebGLGraphics.buildRoundedRectangle(r,f)),u.lastIndex++;for(e=0;e<u.data.length;e++)f=u.data[e],f.dirty&&f.upload()},n.WebGLGraphics.switchMode=function(t,i){var r;return t.data.length?(r=t.data[t.data.length-1],(r.mode!==i||1===i)&&(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r))):(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r)),r.dirty=!0,r},n.WebGLGraphics.buildRectangle=function(t,i){var s=t.shape,r=s.x,u=s.y,h=s.width,c=s.height,p;if(t.fill){var y=n.hex2rgb(t.fillColor),e=t.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,w=i.indices,o=f.length/6;f.push(r,u),f.push(l,a,v,e),f.push(r+h,u),f.push(l,a,v,e),f.push(r,u+c),f.push(l,a,v,e),f.push(r+h,u+c),f.push(l,a,v,e),w.push(o,o,o+1,o+2,o+3,o+3)}t.lineWidth&&(p=t.points,t.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],n.WebGLGraphics.buildLine(t,i),t.points=p)},n.WebGLGraphics.buildRoundedRectangle=function(t,i){var l=t.shape,u=l.x,f=l.y,s=l.width,h=l.height,o=l.radius,r=[],b;if(r.push(u,f+o),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u,f+h-o,u,f+h,u+o,f+h)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s-o,f+h,u+s,f+h,u+s,f+h-o)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s,f+o,u+s,f,u+s-o,f)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+o,f,u,f,u,f+o)),t.fill){for(var p=n.hex2rgb(t.fillColor),y=t.fillAlpha,g=p[0]*y,d=p[1]*y,k=p[2]*y,w=i.points,v=i.indices,a=w.length/6,c=n.PolyK.Triangulate(r),e=0,e=0;e<c.length;e+=3)v.push(c[e]+a),v.push(c[e]+a),v.push(c[e+1]+a),v.push(c[e+2]+a),v.push(c[e+2]+a);for(e=0;e<r.length;e++)w.push(r[e],r[++e],g,d,k,y)}t.lineWidth&&(b=t.points,t.points=r,n.WebGLGraphics.buildLine(t,i),t.points=b)},n.WebGLGraphics.quadraticBezierCurve=function(n,t,i,r,u,f){function o(n,t,i){var r=t-n;return n+r*i}for(var p,w,h,c,l,a,v=20,y=[],e=0,s=0;v>=s;s++)e=s/v,p=o(n,i,e),w=o(t,r,e),h=o(i,u,e),c=o(r,f,e),l=o(p,h,e),a=o(w,c,e),y.push(l,a);return y},n.WebGLGraphics.buildCircle=function(t,i){var h,e,u=t.shape,c=u.x,l=u.y,d;t.type===n.Graphics.CIRC?(h=u.radius,e=u.radius):(h=u.width,e=u.height);var a=40,o=2*Math.PI/a,r=0;if(t.fill){var v=n.hex2rgb(t.fillColor),f=t.fillAlpha,w=v[0]*f,b=v[1]*f,k=v[2]*f,y=i.points,p=i.indices,s=y.length/6;for(p.push(s),r=0;a+1>r;r++)y.push(c,l,w,b,k,f),y.push(c+Math.sin(o*r)*h,l+Math.cos(o*r)*e,w,b,k,f),p.push(s++,s++);p.push(s-1)}if(t.lineWidth){for(d=t.points,t.points=[],r=0;a+1>r;r++)t.points.push(c+Math.sin(o*r)*h,l+Math.cos(o*r)*e);n.WebGLGraphics.buildLine(t,i),t.points=d}},n.WebGLGraphics.buildLine=function(t,i){var h=0,r=t.points,it,tt,lt,ct;if(0!==r.length){if(t.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new n.Point(r[0],r[1]),tt=new n.Point(r[r.length-2],r[r.length-1]),it.x===tt.x&&it.y===tt.y&&(r=r.slice(),r.pop(),r.pop(),tt=new n.Point(r[r.length-2],r[r.length-1]),lt=tt.x+.5*(it.x-tt.x),ct=tt.y+.5*(it.y-tt.y),r.unshift(lt,ct),r.push(lt,ct));var ut,rt,p,d,o,e,ot,st,f,u,w,b,g,nt,bt,pt,vt,ht,kt,dt,et,gt,c,s=i.points,at=i.indices,ft=r.length/2,ni=r.length,yt=s.length/6,k=t.lineWidth/2,wt=n.hex2rgb(t.lineColor),l=t.lineAlpha,a=wt[0]*l,v=wt[1]*l,y=wt[2]*l;for(p=r[0],d=r[1],o=r[2],e=r[3],f=-(d-e),u=p-o,c=Math.sqrt(f*f+u*u),f/=c,u/=c,f*=k,u*=k,s.push(p-f,d-u,a,v,y,l),s.push(p+f,d+u,a,v,y,l),h=1;ft-1>h;h++)p=r[2*(h-1)],d=r[2*(h-1)+1],o=r[2*h],e=r[2*h+1],ot=r[2*(h+1)],st=r[2*(h+1)+1],f=-(d-e),u=p-o,c=Math.sqrt(f*f+u*u),f/=c,u/=c,f*=k,u*=k,w=-(e-st),b=o-ot,c=Math.sqrt(w*w+b*b),w/=c,b/=c,w*=k,b*=k,bt=-u+d-(-u+e),pt=-f+o-(-f+p),vt=(-f+p)*(-u+e)-(-f+o)*(-u+d),ht=-b+st-(-b+e),kt=-w+o-(-w+ot),dt=(-w+ot)*(-b+e)-(-w+o)*(-b+st),et=bt*kt-ht*pt,Math.abs(et)<.1?(et+=10.1,s.push(o-f,e-u,a,v,y,l),s.push(o+f,e+u,a,v,y,l)):(ut=(pt*dt-kt*vt)/et,rt=(ht*vt-bt*dt)/et,gt=(ut-o)*(ut-o)+(rt-e)+(rt-e),gt>19600?(g=f-w,nt=u-b,c=Math.sqrt(g*g+nt*nt),g/=c,nt/=c,g*=k,nt*=k,s.push(o-g,e-nt),s.push(a,v,y,l),s.push(o+g,e+nt),s.push(a,v,y,l),s.push(o-g,e-nt),s.push(a,v,y,l),ni++):(s.push(ut,rt),s.push(a,v,y,l),s.push(o-(ut-o),e-(rt-e)),s.push(a,v,y,l)));for(p=r[2*(ft-2)],d=r[2*(ft-2)+1],o=r[2*(ft-1)],e=r[2*(ft-1)+1],f=-(d-e),u=p-o,c=Math.sqrt(f*f+u*u),f/=c,u/=c,f*=k,u*=k,s.push(o-f,e-u),s.push(a,v,y,l),s.push(o+f,e+u),s.push(a,v,y,l),at.push(yt),h=0;ni>h;h++)at.push(yt++);at.push(yt-1)}},n.WebGLGraphics.buildComplexPoly=function(t,i){var u=t.points.slice(),l,a;if(!(u.length<6)){l=i.indices,i.points=u,i.alpha=t.fillAlpha,i.color=n.hex2rgb(t.fillColor);for(var f,e,o=1/0,s=-1/0,h=1/0,c=-1/0,r=0;r<u.length;r+=2)f=u[r],e=u[r+1],o=o>f?f:o,s=f>s?f:s,h=h>e?e:h,c=e>c?e:c;for(u.push(o,h,s,h,s,c,o,c),a=u.length/2,r=0;a>r;r++)l.push(r)}},n.WebGLGraphics.buildPoly=function(t,i){var e=t.points,f,r;if(!(e.length<6)){var c=i.points,o=i.indices,l=e.length/2,h=n.hex2rgb(t.fillColor),s=t.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=n.PolyK.Triangulate(e);if(!u)return!1;for(f=c.length/6,r=0,r=0;r<u.length;r+=3)o.push(u[r]+f),o.push(u[r]+f),o.push(u[r+1]+f),o.push(u[r+2]+f),o.push(u[r+2]+f);for(r=0;l>r;r++)c.push(e[2*r],e[2*r+1],a,v,y,s);return!0}},n.WebGLGraphics.graphicsDataPool=[],n.WebGLGraphicsData=function(n){this.gl=n,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},n.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},n.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new n.Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new n.Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},n.glContexts=[],n.instances=[],n.WebGLRenderer=function(t,i,r){if(r)for(var u in n.defaultRenderOptions)"undefined"==typeof r[u]&&(r[u]=n.defaultRenderOptions[u]);else r=n.defaultRenderOptions;n.defaultRenderer||(n.sayHello("webGL"),n.defaultRenderer=this),this.type=n.WEBGL_RENDERER,this.resolution=r.resolution,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this.width=t||800,this.height=i||600,this.view=r.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer},this.projection=new n.Point,this.offset=new n.Point(0,0),this.shaderManager=new n.WebGLShaderManager,this.spriteBatch=new n.WebGLSpriteBatch,this.maskManager=new n.WebGLMaskManager,this.filterManager=new n.WebGLFilterManager,this.stencilManager=new n.WebGLStencilManager,this.blendModeManager=new n.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},n.WebGLRenderer.prototype.constructor=n.WebGLRenderer,n.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=n.WebGLRenderer.glContextId++,n.glContexts[this.glContextId]=t,n.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},n.WebGLRenderer.prototype.render=function(n){if(!this.contextLost){this.__stage!==n&&(n.interactive&&n.interactionManager.removeEvents(),this.__stage=n),n.updateTransform();var t=this.gl;n._interactive?n._interactiveEventsAdded||(n._interactiveEventsAdded=!0,n.interactionManager.setTarget(this)):n._interactiveEventsAdded&&(n._interactiveEventsAdded=!1,n.interactionManager.setTarget(this)),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?t.clearColor(0,0,0,0):t.clearColor(n.backgroundColorSplit[0],n.backgroundColorSplit[1],n.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT)),this.renderDisplayObject(n,this.projection)}},n.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=r?-1:1,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),t._renderWebGL(this.renderSession),this.spriteBatch.end()},n.WebGLRenderer.prototype.resize=function(n,t){this.width=n*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},n.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&n.isPowerOfTwo(t.width,t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}},n.WebGLRenderer.prototype.handleContextLost=function(n){n.preventDefault(),this.contextLost=!0},n.WebGLRenderer.prototype.handleContextRestored=function(){var t,i;this.initContext();for(t in n.TextureCache)i=n.TextureCache[t].baseTexture,i._glTextures=[];this.contextLost=!1},n.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),n.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},n.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;n.blendModesWebGL||(n.blendModesWebGL=[],n.blendModesWebGL[n.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],n.blendModesWebGL[n.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE],n.blendModesWebGL[n.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA])},n.WebGLRenderer.glContextId=0,n.WebGLBlendModeManager=function(){this.currentBlendMode=99999},n.WebGLBlendModeManager.prototype.constructor=n.WebGLBlendModeManager,n.WebGLBlendModeManager.prototype.setContext=function(n){this.gl=n},n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=n.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},n.WebGLMaskManager=function(){},n.WebGLMaskManager.prototype.constructor=n.WebGLMaskManager,n.WebGLMaskManager.prototype.setContext=function(n){this.gl=n},n.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;t.dirty&&n.WebGLGraphics.updateGraphics(t,r),t._webGL[r.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)},n.WebGLMaskManager.prototype.popMask=function(n,t){var i=this.gl;t.stencilManager.popStencil(n,n._webGL[i.id].data[0],t)},n.WebGLMaskManager.prototype.destroy=function(){this.gl=null},n.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},n.WebGLStencilManager.prototype.setContext=function(n){this.gl=n},n.WebGLStencilManager.prototype.pushStencil=function(n,t,i){var r=this.gl,u;this.bindGraphics(n,t,i),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t),u=this.count,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===t.mode?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(u+1),255):r.stencilFunc(r.EQUAL,u+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u+1,255):r.stencilFunc(r.EQUAL,255-(u+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},n.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var f,u=this.gl,e=r.projection,o=r.offset;1===i.mode?(f=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(f),u.uniform1f(f.flipY,r.flipY),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform3fv(f.color,i.color),u.uniform1f(f.alpha,t.worldAlpha*i.alpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,8,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(f=r.shaderManager.primitiveShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform1f(f.flipY,r.flipY),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform1f(f.alpha,t.worldAlpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,24,0),u.vertexAttribPointer(f.colorAttribute,4,u.FLOAT,!1,24,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},n.WebGLStencilManager.prototype.popStencil=function(n,t,i){var r=this.gl,u;(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)?r.disable(r.STENCIL_TEST):(u=this.count,this.bindGraphics(n,t,i),r.colorMask(!1,!1,!1,!1),1===t.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)):(this.reverse?(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))},n.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},n.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var n=0;n<this.maxAttibs;n++)this.attribState[n]=!1;this.stack=[]},n.WebGLShaderManager.prototype.constructor=n.WebGLShaderManager,n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new n.PrimitiveShader(t),this.complexPrimitiveShader=new n.ComplexPrimitiveShader(t),this.defaultShader=new n.PixiShader(t),this.fastShader=new n.PixiFastShader(t),this.stripShader=new n.StripShader(t),this.setShader(this.defaultShader)},n.WebGLShaderManager.prototype.setAttribs=function(n){for(var r,i,t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<n.length;t++)r=n[t],this.tempAttribState[r]=!0;for(i=this.gl,t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))},n.WebGLShaderManager.prototype.setShader=function(n){return this._currentId===n._UID?!1:(this._currentId=n._UID,this.currentShader=n,this.gl.useProgram(n.program),this.setAttribs(n.attributes),!0)},n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},n.WebGLSpriteBatch=function(){var u,r,t,i;for(this.vertSize=5,this.size=2e3,u=16*this.size*this.vertSize,r=6*this.size,this.vertices=new n.ArrayBuffer(u),this.positions=new n.Float32Array(this.vertices),this.colors=new n.Uint32Array(this.vertices),this.indices=new n.Uint16Array(r),this.lastIndexCount=0,t=0,i=0;r>t;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new n.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},n.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new n.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[t.id]=i},n.WebGLSpriteBatch.prototype.begin=function(n){this.renderSession=n,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},n.WebGLSpriteBatch.prototype.end=function(){this.flush()},n.WebGLSpriteBatch.prototype.render=function(n){var f=n.texture,e,o,r,s,u,d,g,w,nt;if(this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture),e=f._uvs,e){d=n.anchor.x,g=n.anchor.y,f.trim?(w=f.trim,r=w.x-d*w.width,o=r+f.crop.width,u=w.y-g*w.height,s=u+f.crop.height):(o=f.frame.width*(1-d),r=f.frame.width*-d,s=f.frame.height*(1-g),u=f.frame.height*-g);var t=4*this.currentBatchSize*this.vertSize,k=f.baseTexture.resolution,p=n.worldTransform,c=p.a/k,l=p.b/k,a=p.c/k,v=p.d/k,y=p.tx,h=p.ty,b=this.colors,i=this.positions;this.renderSession.roundPixels?(i[t]=c*r+a*u+y|0,i[t+1]=v*u+l*r+h|0,i[t+5]=c*o+a*u+y|0,i[t+6]=v*u+l*o+h|0,i[t+10]=c*o+a*s+y|0,i[t+11]=v*s+l*o+h|0,i[t+15]=c*r+a*s+y|0,i[t+16]=v*s+l*r+h|0):(i[t]=c*r+a*u+y,i[t+1]=v*u+l*r+h,i[t+5]=c*o+a*u+y,i[t+6]=v*u+l*o+h,i[t+10]=c*o+a*s+y,i[t+11]=v*s+l*o+h,i[t+15]=c*r+a*s+y,i[t+16]=v*s+l*r+h),i[t+2]=e.x0,i[t+3]=e.y0,i[t+7]=e.x1,i[t+8]=e.y1,i[t+12]=e.x2,i[t+13]=e.y2,i[t+17]=e.x3,i[t+18]=e.y3,nt=n.tint,b[t+4]=b[t+9]=b[t+14]=b[t+19]=(nt>>16)+(65280&nt)+((255&nt)<<16)+(255*n.worldAlpha<<24),this.sprites[this.currentBatchSize++]=n}},n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var f=t.tilingTexture,r;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture),t._uvs||(t._uvs=new n.TextureUvs),r=t._uvs,t.tilePosition.x%=f.baseTexture.width*t.tileScaleOffset.x,t.tilePosition.y%=f.baseTexture.height*t.tileScaleOffset.y;var nt=t.tilePosition.x/(f.baseTexture.width*t.tileScaleOffset.x),g=t.tilePosition.y/(f.baseTexture.height*t.tileScaleOffset.y),ft=t.width/f.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),ut=t.height/f.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);r.x0=0-nt,r.y0=0-g,r.x1=1*ft-nt,r.y1=0-g,r.x2=1*ft-nt,r.y2=1*ut-g,r.x3=0-nt,r.y3=1*ut-g;var tt=t.tint,d=(tt>>16)+(65280&tt)+((255&tt)<<16)+(255*t.alpha<<24),u=this.positions,k=this.colors,rt=t.width,it=t.height,ot=t.anchor.x,et=t.anchor.y,p=rt*(1-ot),y=rt*-ot,v=it*(1-et),a=it*-et,i=4*this.currentBatchSize*this.vertSize,l=f.baseTexture.resolution,e=t.worldTransform,c=e.a/l,h=e.b/l,s=e.c/l,o=e.d/l,b=e.tx,w=e.ty;u[i++]=c*y+s*a+b,u[i++]=o*a+h*y+w,u[i++]=r.x0,u[i++]=r.y0,k[i++]=d,u[i++]=c*p+s*a+b,u[i++]=o*a+h*p+w,u[i++]=r.x1,u[i++]=r.y1,k[i++]=d,u[i++]=c*p+s*v+b,u[i++]=o*v+h*p+w,u[i++]=r.x2,u[i++]=r.y2,k[i++]=d,u[i++]=c*y+s*v+b,u[i++]=o*v+h*y+w,u[i++]=r.x3,u[i++]=r.y3,k[i++]=d,this.sprites[this.currentBatchSize++]=t},n.WebGLSpriteBatch.prototype.flush=function(){var i,t,u,k,w,b;if(0!==this.currentBatchSize){t=this.gl,this.dirty&&(this.dirty=!1,t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i=this.defaultShader.shaders[t.id],u=4*this.vertSize,t.vertexAttribPointer(i.aVertexPosition,2,t.FLOAT,!1,u,0),t.vertexAttribPointer(i.aTextureCoord,2,t.FLOAT,!1,u,8),t.vertexAttribPointer(i.colorAttribute,4,t.UNSIGNED_BYTE,!0,u,16)),this.currentBatchSize>.5*this.size?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(k=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,k));for(var p,y,v,e,o=0,a=0,s=null,l=this.renderSession.blendModeManager.currentBlendMode,r=null,c=!1,h=!1,f=0,d=this.currentBatchSize;d>f;f++)(e=this.sprites[f],p=e.texture.baseTexture,y=e.blendMode,v=e.shader||this.defaultShader,c=l!==y,h=r!==v,(s!==p||c||h)&&(this.renderBatch(s,o,a),a=f,o=0,s=p,c&&(l=y,this.renderSession.blendModeManager.setBlendMode(l)),h))&&(r=v,i=r.shaders[t.id],i||(i=new n.PixiShader(t),i.fragmentSrc=r.fragmentSrc,i.uniforms=r.uniforms,i.init(),r.shaders[t.id]=i),this.renderSession.shaderManager.setShader(i),i.dirty&&i.syncUniforms(),w=this.renderSession.projection,t.uniform2f(i.projectionVector,w.x,w.y),b=this.renderSession.offset,t.uniform2f(i.offsetVector,b.x,b.y)),o++;this.renderBatch(s,o,a),this.currentBatchSize=0}},n.WebGLSpriteBatch.prototype.renderBatch=function(n,t,i){if(0!==t){var r=this.gl;n._dirty[r.id]?this.renderSession.renderer.updateTexture(n):r.bindTexture(r.TEXTURE_2D,n._glTextures[r.id]),r.drawElements(r.TRIANGLES,6*t,r.UNSIGNED_SHORT,12*i),this.renderSession.drawCount++}},n.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},n.WebGLFastSpriteBatch=function(t){var f,u,i,r;for(this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize,f=4*this.size*this.vertSize,u=6*this.maxSize,this.vertices=new n.Float32Array(f),this.indices=new n.Uint16Array(u),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0,i=0,r=0;u>i;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},n.WebGLFastSpriteBatch.prototype.constructor=n.WebGLFastSpriteBatch,n.WebGLFastSpriteBatch.prototype.setContext=function(n){this.gl=n,this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW)},n.WebGLFastSpriteBatch.prototype.begin=function(n,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=n.worldTransform.toArray(!0),this.start()},n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.render=function(n){var r=n.children,t=r[0],i,u;if(t.texture._uvs){for(this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode)),i=0,u=r.length;u>i;i++)this.renderSprite(r[i]);this.flush()}},n.WebGLFastSpriteBatch.prototype.renderSprite=function(n){var r,h,c,o,u,s,f,t,i,e;n.visible&&(n.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=n.texture.baseTexture,n.texture._uvs))&&(i=this.vertices,(r=n.texture._uvs,h=n.texture.frame.width,c=n.texture.frame.height,n.texture.trim)?(e=n.texture.trim,u=e.x-n.anchor.x*e.width,o=u+n.texture.crop.width,f=e.y-n.anchor.y*e.height,s=f+n.texture.crop.height):(o=n.texture.frame.width*(1-n.anchor.x),u=n.texture.frame.width*-n.anchor.x,s=n.texture.frame.height*(1-n.anchor.y),f=n.texture.frame.height*-n.anchor.y),t=4*this.currentBatchSize*this.vertSize,i[t++]=u,i[t++]=f,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x0,i[t++]=r.y1,i[t++]=n.alpha,i[t++]=o,i[t++]=f,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x1,i[t++]=r.y1,i[t++]=n.alpha,i[t++]=o,i[t++]=s,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x2,i[t++]=r.y2,i[t++]=n.alpha,i[t++]=u,i[t++]=s,i[t++]=n.position.x,i[t++]=n.position.y,i[t++]=n.scale.x,i[t++]=n.scale.y,i[t++]=n.rotation,i[t++]=r.x3,i[t++]=r.y3,i[t++]=n.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())},n.WebGLFastSpriteBatch.prototype.flush=function(){var n,t;0!==this.currentBatchSize&&(n=this.gl,(this.currentBaseTexture._glTextures[n.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,n),n.bindTexture(n.TEXTURE_2D,this.currentBaseTexture._glTextures[n.id]),this.currentBatchSize>.5*this.size)?n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices):(t=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),n.bufferSubData(n.ARRAY_BUFFER,0,t)),n.drawElements(n.TRIANGLES,6*this.currentBatchSize,n.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)},n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},n.WebGLFastSpriteBatch.prototype.start=function(){var n=this.gl,i,t;n.activeTexture(n.TEXTURE0),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i=this.renderSession.projection,n.uniform2f(this.shader.projectionVector,i.x,i.y),n.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix),t=4*this.vertSize,n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,t,0),n.vertexAttribPointer(this.shader.aPositionCoord,2,n.FLOAT,!1,t,8),n.vertexAttribPointer(this.shader.aScale,2,n.FLOAT,!1,t,16),n.vertexAttribPointer(this.shader.aRotation,1,n.FLOAT,!1,t,24),n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,t,28),n.vertexAttribPointer(this.shader.colorAttribute,1,n.FLOAT,!1,t,36)},n.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},n.WebGLFilterManager.prototype.constructor=n.WebGLFilterManager,n.WebGLFilterManager.prototype.setContext=function(n){this.gl=n,this.texturePool=[],this.initShaderBuffers()},n.WebGLFilterManager.prototype.begin=function(n,t){this.renderSession=n,this.defaultShader=n.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=t},n.WebGLFilterManager.prototype.pushFilter=function(t){var r=this.gl,e=this.renderSession.projection,o=this.renderSession.offset,s,u,i,f;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t),s=t.filterPasses[0],this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y,u=this.texturePool.pop(),u?u.resize(this.width,this.height):u=new n.FilterTexture(this.gl,this.width,this.height),r.bindTexture(r.TEXTURE_2D,u.texture),i=t._filterArea,f=s.padding,i.x-=f,i.y-=f,i.width+=2*f,i.height+=2*f,i.x<0&&(i.x=0),i.width>this.width&&(i.width=this.width),i.y<0&&(i.y=0),i.height>this.height&&(i.height=this.height),r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer),r.viewport(0,0,i.width,i.height),e.x=i.width/2,e.y=-i.height/2,o.x=-i.x,o.y=-i.y,r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),t._glFilterTexture=u},n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,r=this.filterStack.pop(),i=r._filterArea,h=r._glFilterTexture,p=this.renderSession.projection,d=this.renderSession.offset,e,u,s,g,w,b,y,f,o;if(r.filterPasses.length>1){for(t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),e=h,u=this.texturePool.pop(),u||(u=new n.FilterTexture(this.gl,this.width,this.height)),u.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND),s=0;s<r.filterPasses.length-1;s++)g=r.filterPasses[s],t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.texture),this.applyFilterPass(g,i,i.width,i.height),w=e,e=u,u=w;t.enable(t.BLEND),h=e,this.texturePool.push(u)}b=r.filterPasses[r.filterPasses.length-1],this.offsetX-=i.x,this.offsetY-=i.y;var c=this.width,l=this.height,a=0,v=0,k=this.buffer;0===this.filterStack.length?t.colorMask(!0,!0,!0,!0):(y=this.filterStack[this.filterStack.length-1],i=y._filterArea,c=i.width,l=i.height,a=i.x,v=i.y,k=y._glFilterTexture.frameBuffer),p.x=c/2,p.y=-l/2,d.x=a,d.y=v,i=r._filterArea,f=i.x-a,o=i.y-v,t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=f,this.vertexArray[1]=o+i.height,this.vertexArray[2]=f+i.width,this.vertexArray[3]=o+i.height,this.vertexArray[4]=f,this.vertexArray[5]=o,this.vertexArray[6]=f+i.width,this.vertexArray[7]=o,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,c,l),t.bindFramebuffer(t.FRAMEBUFFER,k),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h.texture),this.applyFilterPass(b,i,c,l),this.texturePool.push(h),r._glFilterTexture=null},n.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,u){var f=this.gl,e=t.shaders[f.id];e||(e=new n.PixiShader(f),e.fragmentSrc=t.fragmentSrc,e.uniforms=t.uniforms,e.init(),t.shaders[f.id]=e),this.renderSession.shaderManager.setShader(e),f.uniform2f(e.projectionVector,r/2,-u/2),f.uniform2f(e.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),e.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(e.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},n.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new n.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new n.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new n.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},n.WebGLFilterManager.prototype.destroy=function(){var n=this.gl,t;for(this.filterStack=null,this.offsetX=0,this.offsetY=0,t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null,n.deleteBuffer(this.vertexBuffer),n.deleteBuffer(this.uvBuffer),n.deleteBuffer(this.colorBuffer),n.deleteBuffer(this.indexBuffer)},n.FilterTexture=function(t,i,r,u){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),u=u||n.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,r)},n.FilterTexture.prototype.constructor=n.FilterTexture,n.FilterTexture.prototype.clear=function(){var n=this.gl;n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)},n.FilterTexture.prototype.resize=function(n,t){if(this.width!==n||this.height!==t){this.width=n,this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,t)}},n.FilterTexture.prototype.destroy=function(){var n=this.gl;n.deleteFramebuffer(this.frameBuffer),n.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},n.CanvasBuffer=function(n,t){this.width=n,this.height=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=n,this.canvas.height=t},n.CanvasBuffer.prototype.constructor=n.CanvasBuffer,n.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},n.CanvasBuffer.prototype.resize=function(n,t){this.width=this.canvas.width=n,this.height=this.canvas.height=t},n.CanvasMaskManager=function(){},n.CanvasMaskManager.prototype.constructor=n.CanvasMaskManager,n.CanvasMaskManager.prototype.pushMask=function(t,i){var f=i.context;f.save();var e=t.alpha,r=t.worldTransform,u=i.resolution;f.setTransform(r.a*u,r.b*u,r.c*u,r.d*u,r.tx*u,r.ty*u),n.CanvasGraphics.renderGraphicsMask(t,f),f.clip(),t.worldAlpha=e},n.CanvasMaskManager.prototype.popMask=function(n){n.context.restore()},n.CanvasTinter=function(){},n.CanvasTinter.getTintedTexture=function(t,i){var r=t.texture,u,f,e;return(i=n.CanvasTinter.roundColor(i),u="#"+("00000"+(0|i).toString(16)).substr(-6),r.tintCache=r.tintCache||{},r.tintCache[u])?r.tintCache[u]:(f=n.CanvasTinter.canvas||document.createElement("canvas"),(n.CanvasTinter.tintMethod(r,i,f),n.CanvasTinter.convertTintToImage)?(e=new Image,e.src=f.toDataURL(),r.tintCache[u]=e):(r.tintCache[u]=f,n.CanvasTinter.canvas=null),f)},n.CanvasTinter.tintWithMultiply=function(n,t,i){var u=i.getContext("2d"),r=n.crop;i.width=r.width,i.height=r.height,u.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),u.fillRect(0,0,r.width,r.height),u.globalCompositeOperation="multiply",u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),u.globalCompositeOperation="destination-atop",u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},n.CanvasTinter.tintWithOverlay=function(n,t,i){var u=i.getContext("2d"),r=n.crop;i.width=r.width,i.height=r.height,u.globalCompositeOperation="copy",u.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),u.fillRect(0,0,r.width,r.height),u.globalCompositeOperation="destination-atop",u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},n.CanvasTinter.tintWithPerPixel=function(t,i,r){var e=r.getContext("2d"),u=t.crop;r.width=u.width,r.height=u.height,e.globalCompositeOperation="copy",e.drawImage(t.baseTexture.source,u.x,u.y,u.width,u.height,0,0,u.width,u.height);for(var s=n.hex2rgb(i),c=s[0],l=s[1],a=s[2],h=e.getImageData(0,0,u.width,u.height),o=h.data,f=0;f<o.length;f+=4)o[f+0]*=c,o[f+1]*=l,o[f+2]*=a;e.putImageData(h,0,0)},n.CanvasTinter.roundColor=function(t){var r=n.CanvasTinter.cacheStepsPerColorChannel,i=n.hex2rgb(t);return i[0]=Math.min(255,i[0]/r*r),i[1]=Math.min(255,i[1]/r*r),i[2]=Math.min(255,i[2]/r*r),n.rgb2hex(i)},n.CanvasTinter.cacheStepsPerColorChannel=8,n.CanvasTinter.convertTintToImage=!1,n.CanvasTinter.canUseMultiply=n.canUseNewCanvasBlendModes(),n.CanvasTinter.tintMethod=n.CanvasTinter.canUseMultiply?n.CanvasTinter.tintWithMultiply:n.CanvasTinter.tintWithPerPixel,n.CanvasRenderer=function(t,i,r){if(r)for(var u in n.defaultRenderOptions)"undefined"==typeof r[u]&&(r[u]=n.defaultRenderOptions[u]);else r=n.defaultRenderOptions;n.defaultRenderer||(n.sayHello("Canvas"),n.defaultRenderer=this),this.type=n.CANVAS_RENDERER,this.resolution=r.resolution,this.clearBeforeRender=r.clearBeforeRender,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.width=t||800,this.height=i||600,this.width*=this.resolution,this.height*=this.resolution,this.view=r.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new n.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(t,i),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},n.CanvasRenderer.prototype.constructor=n.CanvasRenderer,n.CanvasRenderer.prototype.render=function(t){t.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=n.blendModes.NORMAL,this.context.globalCompositeOperation=n.blendModesCanvas[n.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)))},n.CanvasRenderer.prototype.destroy=function(n){"undefined"==typeof n&&(n=!0),n&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},n.CanvasRenderer.prototype.resize=function(n,t){this.width=n*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},n.CanvasRenderer.prototype.renderDisplayObject=function(n,t){this.renderSession.context=t||this.context,this.renderSession.resolution=this.resolution,n._renderCanvas(this.renderSession)},n.CanvasRenderer.prototype.mapBlendModes=function(){n.blendModesCanvas||(n.blendModesCanvas=[],n.canUseNewCanvasBlendModes()?(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="multiply",n.blendModesCanvas[n.blendModes.SCREEN]="screen",n.blendModesCanvas[n.blendModes.OVERLAY]="overlay",n.blendModesCanvas[n.blendModes.DARKEN]="darken",n.blendModesCanvas[n.blendModes.LIGHTEN]="lighten",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="color-dodge",n.blendModesCanvas[n.blendModes.COLOR_BURN]="color-burn",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="hard-light",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="soft-light",n.blendModesCanvas[n.blendModes.DIFFERENCE]="difference",n.blendModesCanvas[n.blendModes.EXCLUSION]="exclusion",n.blendModesCanvas[n.blendModes.HUE]="hue",n.blendModesCanvas[n.blendModes.SATURATION]="saturation",n.blendModesCanvas[n.blendModes.COLOR]="color",n.blendModesCanvas[n.blendModes.LUMINOSITY]="luminosity"):(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="source-over",n.blendModesCanvas[n.blendModes.SCREEN]="source-over",n.blendModesCanvas[n.blendModes.OVERLAY]="source-over",n.blendModesCanvas[n.blendModes.DARKEN]="source-over",n.blendModesCanvas[n.blendModes.LIGHTEN]="source-over",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="source-over",n.blendModesCanvas[n.blendModes.COLOR_BURN]="source-over",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.DIFFERENCE]="source-over",n.blendModesCanvas[n.blendModes.EXCLUSION]="source-over",n.blendModesCanvas[n.blendModes.HUE]="source-over",n.blendModesCanvas[n.blendModes.SATURATION]="source-over",n.blendModesCanvas[n.blendModes.COLOR]="source-over",n.blendModesCanvas[n.blendModes.LUMINOSITY]="source-over"))},n.CanvasGraphics=function(){},n.CanvasGraphics.renderGraphics=function(t,i){var h=t.worldAlpha,it,f,w;for(t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1),it=0;it<t.graphicsData.length;it++){var r=t.graphicsData[it],u=r.shape,k=r._fillTint,b=r._lineTint;if(i.lineWidth=r.lineWidth,r.type===n.Graphics.POLY){for(i.beginPath(),f=u.points,i.moveTo(f[0],f[1]),w=1;w<f.length/2;w++)i.lineTo(f[2*w],f[2*w+1]);u.closed&&i.lineTo(f[0],f[1]),f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|k).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|b).toString(16)).substr(-6),i.stroke())}else if(r.type===n.Graphics.RECT)(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|k).toString(16)).substr(-6),i.fillRect(u.x,u.y,u.width,u.height)),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|b).toString(16)).substr(-6),i.strokeRect(u.x,u.y,u.width,u.height));else if(r.type===n.Graphics.CIRC)i.beginPath(),i.arc(u.x,u.y,u.radius,0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|k).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|b).toString(16)).substr(-6),i.stroke());else if(r.type===n.Graphics.ELIP){var tt=2*u.width,nt=2*u.height,y=u.x-tt/2,p=u.y-nt/2;i.beginPath();var ft=.5522848,d=tt/2*ft,g=nt/2*ft,rt=y+tt,ut=p+nt,v=y+tt/2,a=p+nt/2;i.moveTo(y,a),i.bezierCurveTo(y,a-g,v-d,p,v,p),i.bezierCurveTo(v+d,p,rt,a-g,rt,a),i.bezierCurveTo(rt,a+g,v+d,ut,v,ut),i.bezierCurveTo(v-d,ut,y,a+g,y,a),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|k).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|b).toString(16)).substr(-6),i.stroke())}else if(r.type===n.Graphics.RREC){var o=u.x,e=u.y,l=u.width,c=u.height,s=u.radius,et=Math.min(l,c)/2|0;s=s>et?et:s,i.beginPath(),i.moveTo(o,e+s),i.lineTo(o,e+c-s),i.quadraticCurveTo(o,e+c,o+s,e+c),i.lineTo(o+l-s,e+c),i.quadraticCurveTo(o+l,e+c,o+l,e+c-s),i.lineTo(o+l,e+s),i.quadraticCurveTo(o+l,e,o+l-s,e),i.lineTo(o+s,e),i.quadraticCurveTo(o,e,o,e+s),i.closePath(),(r.fillColor||0===r.fillColor)&&(i.globalAlpha=r.fillAlpha*h,i.fillStyle="#"+("00000"+(0|k).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*h,i.strokeStyle="#"+("00000"+(0|b).toString(16)).substr(-6),i.stroke())}}},n.CanvasGraphics.renderGraphicsMask=function(t,i){var rt=t.graphicsData.length,g,l,r,e,y;if(0!==rt)for(rt>1&&(rt=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")),g=0;1>g;g++)if(l=t.graphicsData[g],r=l.shape,l.type===n.Graphics.POLY){for(i.beginPath(),e=r.points,i.moveTo(e[0],e[1]),y=1;y<e.length/2;y++)i.lineTo(e[2*y],e[2*y+1]);e[0]===e[e.length-2]&&e[1]===e[e.length-1]&&i.closePath()}else if(l.type===n.Graphics.RECT)i.beginPath(),i.rect(r.x,r.y,r.width,r.height),i.closePath();else if(l.type===n.Graphics.CIRC)i.beginPath(),i.arc(r.x,r.y,r.radius,0,2*Math.PI),i.closePath();else if(l.type===n.Graphics.ELIP){var b=2*r.width,nt=2*r.height,a=r.x-b/2,w=r.y-nt/2;i.beginPath();var ut=.5522848,k=b/2*ut,d=nt/2*ut,tt=a+b,it=w+nt,v=a+b/2,s=w+nt/2;i.moveTo(a,s),i.bezierCurveTo(a,s-d,v-k,w,v,w),i.bezierCurveTo(v+k,w,tt,s-d,tt,s),i.bezierCurveTo(tt,s+d,v+k,it,v,it),i.bezierCurveTo(v-k,it,a,s+d,a,s),i.closePath()}else if(l.type===n.Graphics.RREC){var p=r.points,f=p[0],u=p[1],h=p[2],c=p[3],o=p[4],ft=Math.min(h,c)/2|0;o=o>ft?ft:o,i.beginPath(),i.moveTo(f,u+o),i.lineTo(f,u+c-o),i.quadraticCurveTo(f,u+c,f+o,u+c),i.lineTo(f+h-o,u+c),i.quadraticCurveTo(f+h,u+c,f+h,u+c-o),i.lineTo(f+h,u+o),i.quadraticCurveTo(f+h,u,f+h-o,u),i.lineTo(f+o,u),i.quadraticCurveTo(f,u,f,u+o),i.closePath()}},n.CanvasGraphics.updateGraphicsTint=function(n){if(16777215!==n.tint)for(var f=(n.tint>>16&255)/255,e=(n.tint>>8&255)/255,o=(255&n.tint)/255,i=0;i<n.graphicsData.length;i++){var t=n.graphicsData[i],r=0|t.fillColor,u=0|t.lineColor;t._fillTint=((r>>16&255)/255*f*255<<16)+((r>>8&255)/255*e*255<<8)+(255&r)/255*o*255,t._lineTint=((u>>16&255)/255*f*255<<16)+((u>>8&255)/255*e*255<<8)+(255&u)/255*o*255}},n.Graphics=function(){n.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=n.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new n.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Graphics.prototype.constructor=n.Graphics,Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap=n,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),n.Graphics.prototype.lineStyle=function(t,i,r){if(this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:r,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new n.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},n.Graphics.prototype.moveTo=function(t,i){return this.drawShape(new n.Polygon([t,i])),this},n.Graphics.prototype.lineTo=function(n,t){return this.currentPath.shape.points.push(n,t),this.dirty=!0,this},n.Graphics.prototype.quadraticCurveTo=function(n,t,i,r){var e,o,s,u;this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0),s=20,u=this.currentPath.shape.points,0===u.length&&this.moveTo(0,0);for(var c=u[u.length-2],l=u[u.length-1],f=0,h=1;s>=h;h++)f=h/s,e=c+(n-c)*f,o=l+(t-l)*f,u.push(e+(n+(i-n)*f-e)*f,o+(t+(r-t)*f-o)*f);return this.dirty=!0,this},n.Graphics.prototype.bezierCurveTo=function(n,t,i,r,u,f){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,h,l,c,a,y=20,s=this.currentPath.shape.points,p=s[s.length-2],w=s[s.length-1],e=0,v=1;y>=v;v++)e=v/y,o=1-e,h=o*o,l=h*o,c=e*e,a=c*e,s.push(l*p+3*h*e*n+3*o*c*i+a*u,l*w+3*h*e*t+3*o*c*r+a*f);return this.dirty=!0,this},n.Graphics.prototype.arcTo=function(n,t,i,r,u){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(n,t):this.moveTo(n,t);var f=this.currentPath.shape.points,tt=f[f.length-2],nt=f[f.length-1],h=nt-t,s=tt-n,o=r-t,e=i-n,y=Math.abs(h*e-s*o);if(1e-8>y||0===u)(f[f.length-2]!==n||f[f.length-1]!==t)&&f.push(n,t);else{var b=h*h+s*s,k=o*o+e*e,d=h*o+s*e,l=u*Math.sqrt(b)/y,c=u*Math.sqrt(k)/y,w=l*d/b,p=c*d/k,a=l*e+c*s,v=l*o+c*h,it=s*(c+w),rt=h*(c+w),ut=e*(l+p),ft=o*(l+p),g=Math.atan2(rt-v,it-a),et=Math.atan2(ft-v,ut-a);this.arc(a+n,v+t,u,g,et,s*o>e*h)}return this.dirty=!0,this},n.Graphics.prototype.arc=function(n,t,i,r,u,f){var e,o=n+Math.cos(r)*i,s=t+Math.sin(r)*i,h,v;if((this.currentPath?(e=this.currentPath.shape.points,0===e.length?e.push(o,s):(e[e.length-2]!==o||e[e.length-1]!==s)&&e.push(o,s)):(this.moveTo(o,s),e=this.currentPath.shape.points),r===u)||(!f&&r>=u?u+=2*Math.PI:f&&u>=r&&(r+=2*Math.PI),h=f?-1*(r-u):u-r,v=Math.abs(h)/(2*Math.PI)*40,0===h))return this;for(var l=h/(2*v),d=2*l,b=Math.cos(l),y=Math.sin(l),a=v-1,g=a%1/a,c=0;a>=c;c++){var nt=c+g*c,w=l+r+d*nt,p=Math.cos(w),k=-Math.sin(w);e.push((b*p+y*k)*i+n,(b*-k+y*p)*i+t)}return this.dirty=!0,this},n.Graphics.prototype.beginFill=function(n,t){return this.filling=!0,this.fillColor=n||0,this.fillAlpha=void 0===t?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},n.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},n.Graphics.prototype.drawRect=function(t,i,r,u){return this.drawShape(new n.Rectangle(t,i,r,u)),this},n.Graphics.prototype.drawRoundedRect=function(t,i,r,u,f){return this.drawShape(new n.RoundedRectangle(t,i,r,u,f)),this},n.Graphics.prototype.drawCircle=function(t,i,r){return this.drawShape(new n.Circle(t,i,r)),this},n.Graphics.prototype.drawEllipse=function(t,i,r,u){return this.drawShape(new n.Ellipse(t,i,r,u)),this},n.Graphics.prototype.drawPolygon=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new n.Polygon(t)),this},n.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},n.Graphics.prototype.generateTexture=function(t,i){t=t||1;var r=this.getBounds(),u=new n.CanvasBuffer(r.width*t,r.height*t),f=n.Texture.fromCanvas(u.canvas,i);return f.baseTexture.resolution=t,u.context.scale(t,t),u.context.translate(-r.x,-r.y),n.CanvasGraphics.renderGraphics(this,u.context),f},n.Graphics.prototype._renderWebGL=function(t){var r,i,u;if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);if((t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode)&&(t.spriteBatch.currentBlendMode=this.blendMode,r=n.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(r[0],r[1])),this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),n.WebGLGraphics.renderGraphics(this,t),this.children.length){for(t.spriteBatch.start(),i=0,u=this.children.length;u>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},n.Graphics.prototype._renderCanvas=function(t){var u,i,r,f,e;if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);for(u=t.context,i=this.worldTransform,this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,u.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),r=t.resolution,u.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r),n.CanvasGraphics.renderGraphics(this,u),f=0,e=this.children.length;e>f;f++)this.children[f]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},n.Graphics.prototype.getBounds=function(t){if(this.isMask)return n.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var o=this._localBounds,w=o.x,s=o.width+o.x,it=o.y,tt=o.height+o.y,e=t||this.worldTransform,nt=e.a,g=e.b,d=e.c,k=e.d,b=e.tx,p=e.ty,ut=nt*s+d*tt+b,rt=k*tt+g*s+p,y=nt*w+d*tt+b,v=k*tt+g*w+p,a=nt*w+d*it+b,l=k*it+g*w+p,c=nt*s+d*it+b,h=k*it+g*s+p,f=ut,u=rt,i=ut,r=rt;return i=i>y?y:i,i=i>a?a:i,i=i>c?c:i,r=r>v?v:r,r=r>l?l:r,r=r>h?h:r,f=y>f?y:f,f=a>f?a:f,f=c>f?c:f,u=v>u?v:u,u=l>u?l:u,u=h>u?h:u,this._bounds.x=i,this._bounds.width=f-i,this._bounds.y=r,this._bounds.height=u-r,this._bounds},n.Graphics.prototype.updateLocalBounds=function(){var u=1/0,e=-1/0,f=1/0,o=-1/0,s,v,t,i,h,c,y,l,a;if(this.graphicsData.length)for(y=0;y<this.graphicsData.length;y++){var w=this.graphicsData[y],p=w.type,r=w.lineWidth;if(s=w.shape,p===n.Graphics.RECT||p===n.Graphics.RREC)t=s.x-r/2,i=s.y-r/2,h=s.width+r,c=s.height+r,u=u>t?t:u,e=t+h>e?t+h:e,f=f>i?i:f,o=i+c>o?i+c:o;else if(p===n.Graphics.CIRC)t=s.x,i=s.y,h=s.radius+r/2,c=s.radius+r/2,u=u>t-h?t-h:u,e=t+h>e?t+h:e,f=f>i-c?i-c:f,o=i+c>o?i+c:o;else if(p===n.Graphics.ELIP)t=s.x,i=s.y,h=s.width+r/2,c=s.height+r/2,u=u>t-h?t-h:u,e=t+h>e?t+h:e,f=f>i-c?i-c:f,o=i+c>o?i+c:o;else for(v=s.points,l=0;l<v.length;l+=2)t=v[l],i=v[l+1],u=u>t-r?t-r:u,e=t+r>e?t+r:e,f=f>i-r?i-r:f,o=i+r>o?i+r:o}else u=0,e=0,f=0,o=0;a=this.boundsPadding,this._localBounds.x=u-a,this._localBounds.width=e-u+2*a,this._localBounds.y=f-a,this._localBounds.height=o-f+2*a},n.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds(),i,r;this._cachedSprite?this._cachedSprite.buffer.resize(t.width,t.height):(i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas),this._cachedSprite=new n.Sprite(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,n.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},n.Graphics.prototype.updateCachedSpriteTexture=function(){var i=this._cachedSprite,n=i.texture,t=i.buffer.canvas;n.baseTexture.width=t.width,n.baseTexture.height=t.height,n.crop.width=n.frame.width=t.width,n.crop.height=n.frame.height=t.height,i._width=t.width,i._height=t.height,n.baseTexture.dirty()},n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},n.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var i=new n.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(i),i.type===n.Graphics.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i},n.GraphicsData=function(n,t,i,r,u,f,e){this.lineWidth=n,this.lineColor=t,this.lineAlpha=i,this._lineTint=t,this.fillColor=r,this.fillAlpha=u,this._fillTint=r,this.fill=f,this.shape=e,this.type=e.type},n.Graphics.POLY=0,n.Graphics.RECT=1,n.Graphics.CIRC=2,n.Graphics.ELIP=3,n.Graphics.RREC=4,n.Polygon.prototype.type=n.Graphics.POLY,n.Rectangle.prototype.type=n.Graphics.RECT,n.Circle.prototype.type=n.Graphics.CIRC,n.Ellipse.prototype.type=n.Graphics.ELIP,n.RoundedRectangle.prototype.type=n.Graphics.RREC,n.Strip=function(t){n.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new n.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new n.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new n.Float32Array([1,1,1,1]),this.indices=new n.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=n.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=n.Strip.DrawModes.TRIANGLE_STRIP},n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Strip.prototype.constructor=n.Strip,n.Strip.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||(n.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(n),n.shaderManager.setShader(n.shaderManager.stripShader),this._renderStrip(n),n.spriteBatch.start())},n.Strip.prototype._initWebGL=function(n){var t=n.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},n.Strip.prototype._renderStrip=function(t){var i=t.gl,u=t.projection,f=t.offset,r=t.shaderManager.stripShader,e=this.drawMode===n.Strip.DrawModes.TRIANGLE_STRIP?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),i.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0)),i.uniform2f(r.projectionVector,u.x,-u.y),i.uniform2f(r.offsetVector,-f.x,-f.y),i.uniform1f(r.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STATIC_DRAW),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),this.texture.baseTexture._dirty[i.id]?t.renderer.updateTexture(this.texture.baseTexture):i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),i.drawElements(e,this.indices.length,i.UNSIGNED_SHORT,0)},n.Strip.prototype._renderCanvas=function(t){var r=t.context,i=this.worldTransform;t.roundPixels?r.setTransform(i.a,i.b,i.c,i.d,0|i.tx,0|i.ty):r.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.drawMode===n.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(r):this._renderCanvasTriangles(r)},n.Strip.prototype._renderCanvasTriangleStrip=function(n){var r=this.vertices,u=this.uvs,f=r.length/2,t,i;for(this.count++,t=0;f-2>t;t++)i=2*t,this._renderCanvasDrawTriangle(n,r,u,i,i+2,i+4)},n.Strip.prototype._renderCanvasTriangles=function(n){var r=this.vertices,u=this.uvs,i=this.indices,f=i.length,t;for(this.count++,t=0;f>t;t+=3){var e=2*i[t],o=2*i[t+1],s=2*i[t+2];this._renderCanvasDrawTriangle(n,r,u,e,o,s)}},n.Strip.prototype._renderCanvasDrawTriangle=function(n,t,i,r,u,f){var ot=this.texture.baseTexture.source,ft=this.texture.width,ut=this.texture.height,d=t[r],k=t[u],b=t[f],w=t[r+1],p=t[u+1],g=t[f+1],v=i[r]*ft,a=i[u]*ft,y=i[f]*ft,l=i[r+1]*ut,c=i[u+1]*ut,h=i[f+1]*ut;if(this.canvasPadding>0){var rt=this.canvasPadding/this.worldTransform.a,et=this.canvasPadding/this.worldTransform.d,tt=(d+k+b)/3,it=(w+p+g)/3,s=d-tt,o=w-it,e=Math.sqrt(s*s+o*o);d=tt+s/e*(e+rt),w=it+o/e*(e+et),s=k-tt,o=p-it,e=Math.sqrt(s*s+o*o),k=tt+s/e*(e+rt),p=it+o/e*(e+et),s=b-tt,o=g-it,e=Math.sqrt(s*s+o*o),b=tt+s/e*(e+rt),g=it+o/e*(e+et)}n.save(),n.beginPath(),n.moveTo(d,w),n.lineTo(k,p),n.lineTo(b,g),n.closePath(),n.clip();var nt=v*c+l*y+a*h-c*y-l*a-v*h,ht=d*c+l*b+k*h-c*b-l*k-d*h,ct=v*k+d*y+a*b-k*y-d*a-v*b,lt=v*c*b+l*k*y+d*a*h-d*c*y-l*a*b-v*k*h,at=w*c+l*g+p*h-c*g-l*p-w*h,st=v*p+w*y+a*g-p*y-w*a-v*g,vt=v*c*g+l*p*y+w*a*h-w*c*y-l*a*g-v*p*h;n.transform(ht/nt,at/nt,ct/nt,st/nt,lt/nt,vt/nt),n.drawImage(ot,0,0),n.restore()},n.Strip.prototype.renderStripFlat=function(n){var t=this.context,i=n.vertices,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;f-2>u;u++){var r=2*u,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h),t.lineTo(o,c),t.lineTo(s,l)}t.fillStyle="#FF0000",t.fill(),t.closePath()},n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},n.Strip.prototype.getBounds=function(t){for(var i,u=t||this.worldTransform,g=u.a,b=u.b,w=u.c,d=u.d,y=u.tx,p=u.ty,o=-1/0,e=-1/0,r=1/0,f=1/0,l=this.vertices,h=0,k=l.length;k>h;h+=2){var a=l[h],v=l[h+1],c=g*a+w*v+y,s=d*v+b*a+p;r=r>c?c:r,f=f>s?s:f,o=c>o?c:o,e=s>e?s:e}return r===-1/0||1/0===e?n.EmptyRectangle:(i=this._bounds,i.x=r,i.width=o-r,i.y=f,i.height=e-f,this._currentBounds=i,i)},n.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},n.Rope=function(t,i){n.Strip.call(this,t),this.points=i,this.vertices=new n.Float32Array(4*i.length),this.uvs=new n.Float32Array(4*i.length),this.colors=new n.Float32Array(2*i.length),this.indices=new n.Uint16Array(2*i.length),this.refresh()},n.Rope.prototype=Object.create(n.Strip.prototype),n.Rope.prototype.constructor=n.Rope,n.Rope.prototype.refresh=function(){var u=this.points,s,n,r,o,i;if(!(u.length<1)){var t=this.uvs,h=u[0],f=this.indices,e=this.colors;for(this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,e[0]=1,e[1]=1,f[0]=0,f[1]=1,o=u.length,i=1;o>i;i++)s=u[i],n=4*i,r=i/(o-1),i%2?(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1):(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1),n=2*i,e[n]=1,e[n+1]=1,n=2*i,f[n]=n,f[n+1]=n+1,h=s}},n.Rope.prototype.updateTransform=function(){var u=this.points,s,e,t;if(!(u.length<1)){e=u[0],t={x:0,y:0},this.count-=.2;for(var i,f,h,c,l,o=this.vertices,a=u.length,r=0;a>r;r++)i=u[r],f=4*r,s=r<u.length-1?u[r+1]:i,t.y=-(s.x-e.x),t.x=s.y-e.y,h=10*(1-r/(a-1)),h>1&&(h=1),c=Math.sqrt(t.x*t.x+t.y*t.y),l=this.texture.height/2,t.x/=c,t.y/=c,t.x*=l,t.y*=l,o[f]=i.x+t.x,o[f+1]=i.y+t.y,o[f+2]=i.x-t.x,o[f+3]=i.y-t.y,e=i;n.DisplayObjectContainer.prototype.updateTransform.call(this)}},n.Rope.prototype.setTexture=function(n){this.texture=n},n.TilingSprite=function(t,i,r){n.Sprite.call(this,t),this._width=i||100,this._height=r||100,this.tileScale=new n.Point(1,1),this.tileScaleOffset=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=n.blendModes.NORMAL},n.TilingSprite.prototype=Object.create(n.Sprite.prototype),n.TilingSprite.prototype.constructor=n.TilingSprite,Object.defineProperty(n.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}}),Object.defineProperty(n.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}}),n.TilingSprite.prototype.setTexture=function(n){this.texture!==n&&(this.texture=n,this.refreshTexture=!0,this.cachedTint=16777215)},n.TilingSprite.prototype._renderWebGL=function(n){if(this.visible!==!1&&0!==this.alpha){var t,i;for(this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(n.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):n.spriteBatch.renderTilingSprite(this),t=0,i=this.children.length;i>t;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop(),this._filters&&n.filterManager.popFilter(),this._mask&&n.maskManager.popMask(this._mask,n),n.spriteBatch.start()}},n.TilingSprite.prototype._renderCanvas=function(t){var i,o,s,u,f,r,e;if(this.visible!==!1&&0!==this.alpha){if(i=t.context,this._mask&&t.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha,u=this.worldTransform,f=t.resolution,i.setTransform(u.a*f,u.b*f,u.c*f,u.d*f,u.tx*f,u.ty*f),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),r=this.tilePosition,e=this.tileScale,r.x%=this.tilingTexture.baseTexture.width,r.y%=this.tilingTexture.baseTexture.height,i.scale(e.x,e.y),i.translate(r.x+this.anchor.x*-this._width,r.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-r.x,-r.y,this._width/e.x,this._height/e.y),i.scale(1/e.x,1/e.y),i.translate(-r.x+this.anchor.x*this._width,-r.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t.context),o=0,s=this.children.length;s>o;o++)this.children[o]._renderCanvas(t)}},n.TilingSprite.prototype.getBounds=function(){var ut=this._width,rt=this._height,tt=ut*(1-this.anchor.x),nt=ut*-this.anchor.x,g=rt*(1-this.anchor.y),d=rt*-this.anchor.y,f=this.worldTransform,k=f.a,b=f.b,w=f.c,p=f.d,y=f.tx,v=f.ty,it=k*nt+w*d+y,a=p*d+b*nt+v,l=k*tt+w*d+y,c=p*d+b*tt+v,h=k*tt+w*g+y,s=p*g+b*tt+v,o=k*nt+w*g+y,e=p*g+b*nt+v,r=-1/0,i=-1/0,n=1/0,t=1/0,u;return n=n>it?it:n,n=n>l?l:n,n=n>h?h:n,n=n>o?o:n,t=t>a?a:t,t=t>c?c:t,t=t>s?s:t,t=t>e?e:t,r=it>r?it:r,r=l>r?l:r,r=h>r?h:r,r=o>r?o:r,i=a>i?a:i,i=c>i?c:i,i=s>i?s:i,i=e>i?e:i,u=this._bounds,u.x=n,u.width=r-n,u.y=t,u.height=i-t,this._currentBounds=u,u},n.TilingSprite.prototype.onTextureUpdate=function(){},n.TilingSprite.prototype.generateTilingTexture=function(t){var e;if(this.texture.baseTexture.hasLoaded){var u,f,i=this.originalTexture||this.texture,r=i.frame,s=r.width!==i.baseTexture.width||r.height!==i.baseTexture.height,o=!1;(t?(u=n.getNextPowerOfTwo(r.width),f=n.getNextPowerOfTwo(r.height),(r.width!==u||r.height!==f||i.baseTexture.width!==u||i.baseTexture.height||f)&&(o=!0)):s&&(u=r.width,f=r.height,o=!0),o)?(this.tilingTexture&&this.tilingTexture.isTiling?(e=this.tilingTexture.canvasBuffer,e.resize(u,f),this.tilingTexture.baseTexture.width=u,this.tilingTexture.baseTexture.height=f,this.tilingTexture.needsUpdate=!0):(e=new n.CanvasBuffer(u,f),this.tilingTexture=n.Texture.fromCanvas(e.canvas),this.tilingTexture.canvasBuffer=e,this.tilingTexture.isTiling=!0),e.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,u,f),this.tileScaleOffset.x=r.width/u,this.tileScaleOffset.y=r.height/f):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=i),this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},n.TilingSprite.prototype.destroy=function(){n.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture.destroy(!0),this.tilingTexture=null},t={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array},t.BoneData=function(n,t){this.name=n,this.parent=t},t.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},t.SlotData=function(n,t){this.name=n,this.boneData=t},t.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},t.IkConstraintData=function(n){this.name=n,this.bones=[]},t.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},t.Bone=function(n,t,i){this.data=n,this.skeleton=t,this.parent=i,this.setToSetupPose()},t.Bone.yDown=!1,t.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var n=this.parent,u,f;n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.data.inheritScale?(this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?n.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=n.worldFlipX!=this.flipX,this.worldFlipY=n.worldFlipY!=this.flipY):(u=this.skeleton.flipX,f=this.skeleton.flipY,this.worldX=u?-this.x:this.x,this.worldY=f!=t.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=u!=this.flipX,this.worldFlipY=f!=this.flipY);var e=this.worldRotation*t.degRad,i=Math.cos(e),r=Math.sin(e);this.worldFlipX?(this.m00=-i*this.worldScaleX,this.m01=r*this.worldScaleY):(this.m00=i*this.worldScaleX,this.m01=-r*this.worldScaleY),this.worldFlipY!=t.Bone.yDown?(this.m10=-r*this.worldScaleX,this.m11=-i*this.worldScaleY):(this.m10=r*this.worldScaleX,this.m11=i*this.worldScaleY)},setToSetupPose:function(){var n=this.data;this.x=n.x,this.y=n.y,this.rotation=n.rotation,this.rotationIK=this.rotation,this.scaleX=n.scaleX,this.scaleY=n.scaleY,this.flipX=n.flipX,this.flipY=n.flipY},worldToLocal:function(n){var f=n[0]-this.worldX,e=n[1]-this.worldY,r=this.m00,o=this.m10,s=this.m01,u=this.m11,i;this.worldFlipX!=(this.worldFlipY!=t.Bone.yDown)&&(r=-r,u=-u),i=1/(r*u-s*o),n[0]=f*r*i-e*s*i,n[1]=e*u*i-f*o*i},localToWorld:function(n){var t=n[0],i=n[1];n[0]=t*this.m00+i*this.m01+this.worldX,n[1]=t*this.m10+i*this.m11+this.worldY}},t.Slot=function(n,t){this.data=n,this.bone=t,this.setToSetupPose()},t.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(n){this.attachment=n,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(n){this._attachmentTime=this.bone.skeleton.time-n},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var n=this.data;this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a;for(var i=this.bone.skeleton.data.slots,t=0,r=i.length;r>t;t++)if(i[t]==n){this.setAttachment(n.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(t,n.attachmentName):null);break}}},t.IkConstraint=function(n,t){this.data=n,this.mix=n.mix,this.bendDirection=n.bendDirection,this.bones=[];for(var i=0,r=n.bones.length;r>i;i++)this.bones.push(t.findBone(n.bones[i].name));this.target=t.findBone(n.target.name)},t.IkConstraint.prototype={apply:function(){var n=this.target,i=this.bones;switch(i.length){case 1:t.IkConstraint.apply1(i[0],n.worldX,n.worldY,this.mix);break;case 2:t.IkConstraint.apply2(i[0],i[1],n.worldX,n.worldY,this.bendDirection,this.mix)}}},t.IkConstraint.apply1=function(n,i,r,u){var e=n.data.inheritRotation&&n.parent?n.parent.worldRotation:0,f=n.rotation,o=Math.atan2(r-n.worldY,i-n.worldX)*t.radDeg-e;n.rotationIK=f+(o-f)*u},t.IkConstraint.apply2=function(n,i,r,u,f,e){var c=i.rotation,y=n.rotation,p,w,o,a,h;if(!e)return i.rotationIK=c,void(n.rotationIK=y);o=t.temp,a=n.parent,a?(o[0]=r,o[1]=u,a.worldToLocal(o),r=(o[0]-n.x)*a.worldScaleX,u=(o[1]-n.y)*a.worldScaleY):(r-=n.x,u-=n.y),i.parent==n?(p=i.x,w=i.y):(o[0]=i.x,o[1]=i.y,i.parent.localToWorld(o),n.worldToLocal(o),p=o[0],w=o[1]);var b=p*n.worldScaleX,k=w*n.worldScaleY,d=Math.atan2(k,b),v=Math.sqrt(b*b+k*k),l=i.data.length*i.worldScaleX,g=2*v*l;if(.0001>g)return void(i.rotationIK=c+(Math.atan2(u,r)*t.radDeg-y-c)*e);h=(r*r+u*u-v*v-l*l)/g,-1>h?h=-1:h>1&&(h=1);var nt=Math.acos(h)*f,tt=v+l*h,it=l*Math.sin(nt),rt=Math.atan2(u*tt-r*it,r*tt+u*it),s=(rt-d)*t.radDeg-y;s>180?s-=360:-180>s&&(s+=360),n.rotationIK=y+s*e,s=(nt+d)*t.radDeg-c,s>180?s-=360:-180>s&&(s+=360),i.rotationIK=c+(s+n.worldRotation-i.parent.worldRotation)*e},t.Skin=function(n){this.name=n,this.attachments={}},t.Skin.prototype={addAttachment:function(n,t,i){this.attachments[n+":"+t]=i},getAttachment:function(n,t){return this.attachments[n+":"+t]},_attachAll:function(n,t){var i,u;for(i in t.attachments){var f=i.indexOf(":"),e=parseInt(i.substring(0,f)),o=i.substring(f+1),r=n.slots[e];r.attachment&&r.attachment.name==o&&(u=this.getAttachment(e,o),u&&r.setAttachment(u))}}},t.Animation=function(n,t,i){this.name=n,this.timelines=t,this.duration=i},t.Animation.prototype={apply:function(n,t,i,r,u){r&&0!=this.duration&&(i%=this.duration,t%=this.duration);for(var e=this.timelines,f=0,o=e.length;o>f;f++)e[f].apply(n,t,i,u,1)},mix:function(n,t,i,r,u,f){r&&0!=this.duration&&(i%=this.duration,t%=this.duration);for(var o=this.timelines,e=0,s=o.length;s>e;e++)o[e].apply(n,t,i,u,f)}},t.Animation.binarySearch=function(n,t,i){var f=0,r=Math.floor(n.length/i)-2,u;if(!r)return i;for(u=r>>>1;;){if(n[(u+1)*i]<=t?f=u+1:r=u,f==r)return(f+1)*i;u=f+r>>>1}},t.Animation.binarySearch1=function(n,t){var u=0,i=n.length-2,r;if(!i)return 1;for(r=i>>>1;;){if(n[r+1]<=t?u=r+1:i=r,u==i)return u+1;r=u+i>>>1}},t.Animation.linearSearch=function(n,t,i){for(var r=0,u=n.length-i;u>=r;r+=i)if(n[r]>t)return r;return-1},t.Curves=function(){this.curves=[]},t.Curves.prototype={setLinear:function(n){this.curves[19*n]=0},setStepped:function(n){this.curves[19*n]=1},setCurve:function(n,t,i,r,u){var e=.1,v=e*e,a=v*e,tt=3*e,nt=3*v,g=6*v,o=6*a,d=2*-t+r,k=2*-i+u,h=3*(t-r)+1,s=3*(i-u)+1,l=t*tt+d*nt+h*a,c=i*tt+k*nt+s*a,w=d*g+h*o,p=k*g+s*o,rt=h*o,ut=s*o,f=19*n,y=this.curves;y[f++]=2;for(var b=l,it=c,ft=f+19-1;ft>f;f+=2)y[f]=b,y[f+1]=it,l+=w,c+=p,w+=rt,p+=ut,b+=l,it+=c},getCurvePercent:function(n,t){var f,e,o;t=0>t?0:t>1?1:t;var r=this.curves,i=19*n,s=r[i];if(0===s)return t;if(1==s)return 0;i++;for(var u=0,h=i,c=i+19-1;c>i;i+=2)if(u=r[i],u>=t)return i==h?(f=0,e=0):(f=r[i-2],e=r[i-1]),e+(r[i+1]-e)*(t-f)/(u-f);return o=r[i-1],o+(1-o)*(t-u)/(1-u)}},t.RotateTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=2*n},t.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2,this.frames[n]=t,this.frames[n+1]=i},apply:function(n,i,r,u,f){var o=this.frames,s,e;if(!(r<o[0])){if(s=n.bones[this.boneIndex],r>=o[o.length-2]){for(e=s.data.rotation+o[o.length-1]-s.rotation;e>180;)e-=360;for(;-180>e;)e+=360;return void(s.rotation+=e*f)}var h=t.Animation.binarySearch(o,r,2),l=o[h-1],a=o[h],c=1-(r-a)/(o[h-2]-a);for(c=this.curves.getCurvePercent(h/2-1,c),e=o[h+1]-l;e>180;)e-=360;for(;-180>e;)e+=360;for(e=s.data.rotation+(l+e*c)-s.rotation;e>180;)e-=360;for(;-180>e;)e+=360;s.rotation+=e*f}}},t.TranslateTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=3*n},t.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r},apply:function(n,i,r,u,f){var e=this.frames,o;if(!(r<e[0])){if(o=n.bones[this.boneIndex],r>=e[e.length-3])return o.x+=(o.data.x+e[e.length-2]-o.x)*f,void(o.y+=(o.data.y+e[e.length-1]-o.y)*f);var s=t.Animation.binarySearch(e,r,3),c=e[s-2],l=e[s-1],a=e[s],h=1-(r-a)/(e[s+-3]-a);h=this.curves.getCurvePercent(s/3-1,h),o.x+=(o.data.x+c+(e[s+1]-c)*h-o.x)*f,o.y+=(o.data.y+l+(e[s+2]-l)*h-o.y)*f}}},t.ScaleTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=3*n},t.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r},apply:function(n,i,r,u,f){var e=this.frames,o;if(!(r<e[0])){if(o=n.bones[this.boneIndex],r>=e[e.length-3])return o.scaleX+=(o.data.scaleX*e[e.length-2]-o.scaleX)*f,void(o.scaleY+=(o.data.scaleY*e[e.length-1]-o.scaleY)*f);var s=t.Animation.binarySearch(e,r,3),c=e[s-2],l=e[s-1],a=e[s],h=1-(r-a)/(e[s+-3]-a);h=this.curves.getCurvePercent(s/3-1,h),o.scaleX+=(o.data.scaleX*(c+(e[s+1]-c)*h)-o.scaleX)*f,o.scaleY+=(o.data.scaleY*(l+(e[s+2]-l)*h)-o.scaleY)*f}}},t.ColorTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=5*n},t.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(n,t,i,r,u,f){n*=5,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r,this.frames[n+3]=u,this.frames[n+4]=f},apply:function(n,i,r,u,f){var e=this.frames,v,l,a,y,c,o;if(!(r<e[0])){if(r>=e[e.length-5])c=e.length-1,v=e[c-3],l=e[c-2],a=e[c-1],y=e[c];else{var s=t.Animation.binarySearch(e,r,5),p=e[s-4],w=e[s-3],b=e[s-2],k=e[s-1],d=e[s],h=1-(r-d)/(e[s-5]-d);h=this.curves.getCurvePercent(s/5-1,h),v=p+(e[s+1]-p)*h,l=w+(e[s+2]-w)*h,a=b+(e[s+3]-b)*h,y=k+(e[s+4]-k)*h}o=n.slots[this.slotIndex],1>f?(o.r+=(v-o.r)*f,o.g+=(l-o.g)*f,o.b+=(a-o.b)*f,o.a+=(y-o.a)*f):(o.r=v,o.g=l,o.b=a,o.a=y)}}},t.AttachmentTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=n,this.attachmentNames=[],this.attachmentNames.length=n},t.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t,this.attachmentNames[n]=i},apply:function(n,i,r){var u=this.frames,f,e;if(r<u[0])return void(i>r&&this.apply(n,i,Number.MAX_VALUE,null,0));i>r&&(i=-1),f=r>=u[u.length-1]?u.length-1:t.Animation.binarySearch1(u,r)-1,u[f]<i||(e=this.attachmentNames[f],n.slots[this.slotIndex].setAttachment(e?n.getAttachmentBySlotIndex(this.slotIndex,e):null))}},t.EventTimeline=function(n){this.frames=[],this.frames.length=n,this.events=[],this.events.length=n},t.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t,this.events[n]=i},apply:function(n,i,r,u,f){var o,s,e,h,c;if(u){if(o=this.frames,s=o.length,i>r)this.apply(n,i,Number.MAX_VALUE,u,f),i=-1;else if(i>=o[s-1])return;if(!(r<o[0])){if(i<o[0])e=0;else for(e=t.Animation.binarySearch1(o,i),h=o[e];e>0&&o[e-1]==h;)e--;for(c=this.events;s>e&&r>=o[e];e++)u.push(c[e])}}}},t.DrawOrderTimeline=function(n){this.frames=[],this.frames.length=n,this.drawOrders=[],this.drawOrders.length=n},t.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t,this.drawOrders[n]=i},apply:function(n,i,r){var f=this.frames,s,u,e;if(!(r<f[0])){s=r>=f[f.length-1]?f.length-1:t.Animation.binarySearch1(f,r)-1;var h=n.drawOrder,c=n.slots,o=this.drawOrders[s];if(o)for(u=0,e=o.length;e>u;u++)h[u]=n.slots[o[u]];else for(u=0,e=c.length;e>u;u++)h[u]=c[u]}}},t.FfdTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=n,this.frameVertices=[],this.frameVertices.length=n},t.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(n,t,i){this.frames[n]=t,this.frameVertices[n]=i},apply:function(n,i,r,u,f){var k=n.slots[this.slotIndex],o,y,p,w,e,l;if(k.attachment==this.attachment&&(o=this.frames,!(r<o[0]))){var v=this.frameVertices,c=v[0].length,s=k.attachmentVertices;if(s.length!=c&&(f=1),s.length=c,r>=o[o.length-1])if(y=v[o.length-1],1>f)for(e=0;c>e;e++)s[e]+=(y[e]-s[e])*f;else for(e=0;c>e;e++)s[e]=y[e];else{var a=t.Animation.binarySearch1(o,r),b=o[a],h=1-(r-b)/(o[a-1]-b);if(h=this.curves.getCurvePercent(a-1,0>h?0:h>1?1:h),p=v[a-1],w=v[a],1>f)for(e=0;c>e;e++)l=p[e],s[e]+=(l+(w[e]-l)*h-s[e])*f;else for(e=0;c>e;e++)l=p[e],s[e]=l+(w[e]-l)*h}}}},t.IkConstraintTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=3*n},t.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(n,t,i,r){n*=3,this.frames[n]=t,this.frames[n+1]=i,this.frames[n+2]=r},apply:function(n,i,r,u,f){var e=this.frames,o,a;if(!(r<e[0])){if(o=n.ikConstraints[this.ikConstraintIndex],r>=e[e.length-3])return o.mix+=(e[e.length-2]-o.mix)*f,void(o.bendDirection=e[e.length-1]);var s=t.Animation.binarySearch(e,r,3),c=e[s+-2],l=e[s],h=1-(r-l)/(e[s+-3]-l);h=this.curves.getCurvePercent(s/3-1,h),a=c+(e[s+1]-c)*h,o.mix+=(a-o.mix)*f,o.bendDirection=e[s+-1]}}},t.FlipXTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=2*n},t.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2,this.frames[n]=t,this.frames[n+1]=i?1:0},apply:function(n,i,r){var u=this.frames,f;if(r<u[0])return void(i>r&&this.apply(n,i,Number.MAX_VALUE,null,0));i>r&&(i=-1),f=(r>=u[u.length-2]?u.length:t.Animation.binarySearch(u,r,2))-2,u[f]<i||(n.bones[boneIndex].flipX=0!=u[f+1])}},t.FlipYTimeline=function(n){this.curves=new t.Curves(n),this.frames=[],this.frames.length=2*n},t.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(n,t,i){n*=2,this.frames[n]=t,this.frames[n+1]=i?1:0},apply:function(n,i,r){var u=this.frames,f;if(r<u[0])return void(i>r&&this.apply(n,i,Number.MAX_VALUE,null,0));i>r&&(i=-1),f=(r>=u[u.length-2]?u.length:t.Animation.binarySearch(u,r,2))-2,u[f]<i||(n.bones[boneIndex].flipY=0!=u[f+1])}},t.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},t.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findBoneIndex:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].name==n)return t;return-1},findSlot:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].name==n)return slot[t];return null},findSlotIndex:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].name==n)return t;return-1},findSkin:function(n){for(var i=this.skins,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findEvent:function(n){for(var i=this.events,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findAnimation:function(n){for(var i=this.animations,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},findIkConstraint:function(n){for(var i=this.ikConstraints,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null}},t.Skeleton=function(n){var u,f,i,r;for(this.data=n,this.bones=[],i=0,r=n.bones.length;r>i;i++)u=n.bones[i],f=u.parent?this.bones[n.bones.indexOf(u.parent)]:null,this.bones.push(new t.Bone(u,this,f));for(this.slots=[],this.drawOrder=[],i=0,r=n.slots.length;r>i;i++){var e=n.slots[i],s=this.bones[n.bones.indexOf(e.boneData)],o=new t.Slot(e,s);this.slots.push(o),this.drawOrder.push(o)}for(this.ikConstraints=[],i=0,r=n.ikConstraints.length;r>i;i++)this.ikConstraints.push(new t.IkConstraint(n.ikConstraints[i],this));this.boneCache=[],this.updateCache()},t.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var l=this.ikConstraints,a=l.length,o=a+1,n=this.boneCache,s,h,t,f,r,u,i;for(n.length>o&&(n.length=o),t=0,f=n.length;f>t;t++)n[t].length=0;for(;n.length<o;)n[n.length]=[];s=n[0],h=this.bones;n:for(t=0,f=h.length;f>t;t++){r=h[t],u=r;do{for(i=0;a>i;i++)for(var c=l[i],v=c.bones[0],e=c.bones[c.bones.length-1];;){if(u==e){n[i].push(r),n[i+1].push(r);continue n}if(e==v)break;e=e.parent}u=u.parent}while(u);s[s.length]=r}},updateWorldTransform:function(){for(var t,u,r=this.bones,n=0,e=r.length;e>n;n++)t=r[n],t.rotationIK=t.rotation;for(n=0,u=this.boneCache.length-1;;){for(var f=this.boneCache[n],i=0,o=f.length;o>i;i++)f[i].updateWorldTransform();if(n==u)break;this.ikConstraints[n].apply(),n++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t,i=this.bones,n=0,r=i.length;r>n;n++)i[n].setToSetupPose();for(var u=this.ikConstraints,n=0,r=u.length;r>n;n++)t=u[n],t.bendDirection=t.data.bendDirection,t.mix=t.data.mix},setSlotsToSetupPose:function(){for(var t=this.slots,i=this.drawOrder,n=0,r=t.length;r>n;n++)i[n]=t[n],t[n].setToSetupPose(n)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},findBoneIndex:function(n){for(var i=this.bones,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return t;return-1},findSlot:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},findSlotIndex:function(n){for(var i=this.slots,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return t;return-1},setSkinByName:function(n){var t=this.data.findSkin(n);if(!t)throw"Skin not found: "+n;this.setSkin(t)},setSkin:function(n){var i,r,u;if(n)if(this.skin)n._attachAll(this,this.skin);else for(var f=this.slots,t=0,e=f.length;e>t;t++)i=f[t],r=i.data.attachmentName,r&&(u=n.getAttachment(t,r),u&&i.setAttachment(u));this.skin=n},getAttachmentBySlotName:function(n,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(n),t)},getAttachmentBySlotIndex:function(n,t){if(this.skin){var i=this.skin.getAttachment(n,t);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(n,t):null},setAttachment:function(n,t){for(var u,r,f=this.slots,i=0,e=f.length;e>i;i++)if(u=f[i],u.data.name==n){if(r=null,t&&(r=this.getAttachmentBySlotIndex(i,t),!r))throw"Attachment not found: "+t+", for slot: "+n;return void u.setAttachment(r)}throw"Slot not found: "+n;},findIkConstraint:function(n){for(var i=this.ikConstraints,t=0,r=i.length;r>t;t++)if(i[t].data.name==n)return i[t];return null},update:function(n){this.time+=n}},t.EventData=function(n){this.name=n},t.EventData.prototype={intValue:0,floatValue:0,stringValue:null},t.Event=function(n){this.data=n},t.Event.prototype={intValue:0,floatValue:0,stringValue:null},t.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},t.RegionAttachment=function(n){this.name=n,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},t.RegionAttachment.prototype={type:t.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(n,t,i,r,u){var f=this.uvs;u?(f[2]=n,f[3]=r,f[4]=n,f[5]=t,f[6]=i,f[7]=t,f[0]=i,f[1]=r):(f[0]=n,f[1]=r,f[2]=n,f[3]=t,f[4]=i,f[5]=t,f[6]=i,f[7]=r)},updateOffset:function(){var k=this.width/this.regionOriginalWidth*this.scaleX,h=this.height/this.regionOriginalHeight*this.scaleY,f=-this.width/2*this.scaleX+this.regionOffsetX*k,u=-this.height/2*this.scaleY+this.regionOffsetY*h,e=f+this.regionWidth*k,o=u+this.regionHeight*h,s=this.rotation*t.degRad,i=Math.cos(s),r=Math.sin(s),l=f*i+this.x,a=f*r,v=u*i+this.y,y=u*r,p=e*i+this.x,w=e*r,b=o*i+this.y,c=o*r,n=this.offset;n[0]=l-y,n[1]=v+a,n[2]=l-c,n[3]=b+a,n[4]=p-c,n[5]=b+w,n[6]=p-y,n[7]=v+w},computeVertices:function(n,t,i,r){n+=i.worldX,t+=i.worldY;var f=i.m00,e=i.m01,o=i.m10,s=i.m11,u=this.offset;r[0]=u[0]*f+u[1]*e+n,r[1]=u[0]*o+u[1]*s+t,r[2]=u[2]*f+u[3]*e+n,r[3]=u[2]*o+u[3]*s+t,r[4]=u[4]*f+u[5]*e+n,r[5]=u[4]*o+u[5]*s+t,r[6]=u[6]*f+u[7]*e+n,r[7]=u[6]*o+u[7]*s+t}},t.MeshAttachment=function(n){this.name=n},t.MeshAttachment.prototype={type:t.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var u=this.regionU2-this.regionU,r=this.regionV2-this.regionV,i=this.regionUVs.length,n;if(this.uvs&&this.uvs.length==i||(this.uvs=new t.Float32Array(i)),this.regionRotate)for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*u,this.uvs[n+1]=this.regionV+r-this.regionUVs[n]*r;else for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*u,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*r},computeWorldVertices:function(n,t,i,r){var f=i.bone,u,o,s;n+=f.worldX,t+=f.worldY;var c=f.m00,l=f.m01,a=f.m10,v=f.m11,e=this.vertices,h=e.length;for(i.attachmentVertices.length==h&&(e=i.attachmentVertices),u=0;h>u;u+=2)o=e[u],s=e[u+1],r[u]=o*c+s*l+n,r[u+1]=o*a+s*v+t}},t.SkinnedMeshAttachment=function(n){this.name=n},t.SkinnedMeshAttachment.prototype={type:t.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var u=this.regionU2-this.regionU,r=this.regionV2-this.regionV,i=this.regionUVs.length,n;if(this.uvs&&this.uvs.length==i||(this.uvs=new t.Float32Array(i)),this.regionRotate)for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*u,this.uvs[n+1]=this.regionV+r-this.regionUVs[n]*r;else for(n=0;i>n;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*u,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*r},computeWorldVertices:function(n,t,i,r){var p,v,a,u,l,c,h,k=i.bone.skeleton.bones,s=this.weights,y=this.bones,o=0,f=0,e=0,w=0,d=y.length,b;if(i.attachmentVertices.length)for(b=i.attachmentVertices;d>f;o+=2){for(v=0,a=0,p=y[f++]+f;p>f;f++,e+=3,w+=2)u=k[y[f]],l=s[e]+b[w],c=s[e+1]+b[w+1],h=s[e+2],v+=(l*u.m00+c*u.m01+u.worldX)*h,a+=(l*u.m10+c*u.m11+u.worldY)*h;r[o]=v+n,r[o+1]=a+t}else for(;d>f;o+=2){for(v=0,a=0,p=y[f++]+f;p>f;f++,e+=3)u=k[y[f]],l=s[e],c=s[e+1],h=s[e+2],v+=(l*u.m00+c*u.m01+u.worldX)*h,a+=(l*u.m10+c*u.m11+u.worldY)*h;r[o]=v+n,r[o+1]=a+t}}},t.BoundingBoxAttachment=function(n){this.name=n,this.vertices=[]},t.BoundingBoxAttachment.prototype={type:t.AttachmentType.boundingbox,computeWorldVertices:function(n,t,i,r){var e,o;n+=i.worldX,t+=i.worldY;for(var s=i.m00,h=i.m01,c=i.m10,l=i.m11,f=this.vertices,u=0,a=f.length;a>u;u+=2)e=f[u],o=f[u+1],r[u]=e*s+o*h+n,r[u+1]=e*c+o*l+t}},t.AnimationStateData=function(n){this.skeletonData=n,this.animationToMixTime={}},t.AnimationStateData.prototype={defaultMix:0,setMixByName:function(n,t,i){var u=this.skeletonData.findAnimation(n),r;if(!u)throw"Animation not found: "+n;if(r=this.skeletonData.findAnimation(t),!r)throw"Animation not found: "+t;this.setMix(u,r,i)},setMix:function(n,t,i){this.animationToMixTime[n.name+":"+t.name]=i},getMix:function(n,t){var i=n.name+":"+t.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},t.TrackEntry=function(){},t.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},t.AnimationState=function(n){this.data=n,this.tracks=[],this.events=[]},t.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(n){var i,t,u,r;for(n*=this.timeScale,i=0;i<this.tracks.length;i++)t=this.tracks[i],t&&((t.time+=n*t.timeScale,t.previous)&&(u=n*t.previous.timeScale,t.previous.time+=u,t.mixTime+=u),r=t.next,r?(r.time=t.lastTime-r.delay,r.time>=0&&this.setCurrent(i,r)):!t.loop&&t.lastTime>=t.endTime&&this.clearTrack(i))},apply:function(n){for(var t,u,o,s,h,v,c,l,i=0;i<this.tracks.length;i++)if(t=this.tracks[i],t){this.events.length=0;var r=t.time,a=t.lastTime,f=t.endTime,e=t.loop;for(!e&&r>f&&(r=f),u=t.previous,u?(o=u.time,!u.loop&&o>u.endTime&&(o=u.endTime),u.animation.apply(n,o,o,u.loop,null),s=t.mixTime/t.mixDuration*t.mix,s>=1&&(s=1,t.previous=null),t.animation.mix(n,t.lastTime,r,e,this.events,s)):1==t.mix?t.animation.apply(n,t.lastTime,r,e,this.events):t.animation.mix(n,t.lastTime,r,e,this.events,t.mix),h=0,v=this.events.length;v>h;h++)c=this.events[h],t.onEvent&&t.onEvent(i,c),this.onEvent&&this.onEvent(i,c);(e?a%f>r%f:f>a&&r>=f)&&(l=Math.floor(r/f),t.onComplete&&t.onComplete(i,l),this.onComplete&&this.onComplete(i,l)),t.lastTime=t.time}},clearTracks:function(){for(var n=0,t=this.tracks.length;t>n;n++)this.clearTrack(n);this.tracks.length=0},clearTrack:function(n){if(!(n>=this.tracks.length)){var t=this.tracks[n];t&&(t.onEnd&&t.onEnd(n),this.onEnd&&this.onEnd(n),this.tracks[n]=null)}},_expandToIndex:function(n){if(n<this.tracks.length)return this.tracks[n];for(;n>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(n,t){var i=this._expandToIndex(n),r;i&&(r=i.previous,i.previous=null,i.onEnd&&i.onEnd(n),this.onEnd&&this.onEnd(n),t.mixDuration=this.data.getMix(i.animation,t.animation),t.mixDuration>0&&(t.mixTime=0,t.previous=r&&i.mixTime/i.mixDuration<.5?r:i)),this.tracks[n]=t,t.onStart&&t.onStart(n),this.onStart&&this.onStart(n)},setAnimationByName:function(n,t,i){var r=this.data.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;return this.setAnimation(n,r,i)},setAnimation:function(n,i,r){var u=new t.TrackEntry;return u.animation=i,u.loop=r,u.endTime=i.duration,this.setCurrent(n,u),u},addAnimationByName:function(n,t,i,r){var u=this.data.skeletonData.findAnimation(t);if(!u)throw"Animation not found: "+t;return this.addAnimation(n,u,i,r)},addAnimation:function(n,i,r,u){var e=new t.TrackEntry,f;if(e.animation=i,e.loop=r,e.endTime=i.duration,f=this._expandToIndex(n),f){for(;f.next;)f=f.next;f.next=e}else this.tracks[n]=e;return 0>=u&&(f?u+=f.endTime-this.data.getMix(f.animation,i):u=0),e.delay=u,e},getCurrent:function(n){return n>=this.tracks.length?null:this.tracks[n]}},t.SkeletonJson=function(n){this.attachmentLoader=n},t.SkeletonJson.prototype={scale:1,readSkeletonData:function(n,i){var r=new t.SkeletonData,l,u,rt,ot,e,b,lt,h,f,o,a,ut,it,st,v,tt,at,nt,w,ct,g,d,k,y,ft,ht;r.name=i,l=n.skeleton,l&&(r.hash=l.hash,r.version=l.spine,r.width=l.width||0,r.height=l.height||0);for(var p=n.bones,e=0,b=p.length;b>e;e++){if(u=p[e],rt=null,u.parent&&(rt=r.findBone(u.parent),!rt))throw"Parent bone not found: "+u.parent;f=new t.BoneData(u.name,rt),f.length=(u.length||0)*this.scale,f.x=(u.x||0)*this.scale,f.y=(u.y||0)*this.scale,f.rotation=u.rotation||0,f.scaleX=u.hasOwnProperty("scaleX")?u.scaleX:1,f.scaleY=u.hasOwnProperty("scaleY")?u.scaleY:1,f.inheritScale=u.hasOwnProperty("inheritScale")?u.inheritScale:!0,f.inheritRotation=u.hasOwnProperty("inheritRotation")?u.inheritRotation:!0,r.bones.push(f)}if(ot=n.ik,ot)for(e=0,b=ot.length;b>e;e++){for(var s=ot[e],c=new t.IkConstraintData(s.name),p=s.bones,et=0,yt=p.length;yt>et;et++){if(lt=r.findBone(p[et]),!lt)throw"IK bone not found: "+p[et];c.bones.push(lt)}if(c.target=r.findBone(s.target),!c.target)throw"Target bone not found: "+s.target;c.bendDirection=!s.hasOwnProperty("bendPositive")||s.bendPositive?1:-1,c.mix=s.hasOwnProperty("mix")?s.mix:1,r.ikConstraints.push(c)}for(var vt=n.slots,e=0,b=vt.length;b>e;e++){if(h=vt[e],f=r.findBone(h.bone),!f)throw"Slot bone not found: "+h.bone;o=new t.SlotData(h.name,f),a=h.color,a&&(o.r=this.toColor(a,0),o.g=this.toColor(a,1),o.b=this.toColor(a,2),o.a=this.toColor(a,3)),o.attachmentName=h.attachment,o.additiveBlending=h.additive&&"true"==h.additive,r.slots.push(o)}ut=n.skins;for(it in ut)if(ut.hasOwnProperty(it)){st=ut[it],v=new t.Skin(it);for(tt in st)if(st.hasOwnProperty(tt)){at=r.findSlotIndex(tt),nt=st[tt];for(w in nt)nt.hasOwnProperty(w)&&(ct=this.readAttachment(v,w,nt[w]),ct&&v.addAttachment(at,w,ct))}r.skins.push(v),"default"==v.name&&(r.defaultSkin=v)}g=n.events;for(d in g)g.hasOwnProperty(d)&&(k=g[d],y=new t.EventData(d),y.intValue=k.int||0,y.floatValue=k.float||0,y.stringValue=k.string||null,r.events.push(y));ft=n.animations;for(ht in ft)ft.hasOwnProperty(ht)&&this.readAnimation(ht,ft[ht],r);return r},readAttachment:function(n,i,r){var e,f,u,y,p;i=r.name||i;var v=t.AttachmentType[r.type||"region"],l=r.path||i,o=this.scale;if(v==t.AttachmentType.region)return(e=this.attachmentLoader.newRegionAttachment(n,i,l),!e)?null:(e.path=l,e.x=(r.x||0)*o,e.y=(r.y||0)*o,e.scaleX=r.hasOwnProperty("scaleX")?r.scaleX:1,e.scaleY=r.hasOwnProperty("scaleY")?r.scaleY:1,e.rotation=r.rotation||0,e.width=(r.width||0)*o,e.height=(r.height||0)*o,f=r.color,f&&(e.r=this.toColor(f,0),e.g=this.toColor(f,1),e.b=this.toColor(f,2),e.a=this.toColor(f,3)),e.updateOffset(),e);if(v==t.AttachmentType.mesh)return u=this.attachmentLoader.newMeshAttachment(n,i,l),u?(u.path=l,u.vertices=this.getFloatArray(r,"vertices",o),u.triangles=this.getIntArray(r,"triangles"),u.regionUVs=this.getFloatArray(r,"uvs",1),u.updateUVs(),f=r.color,f&&(u.r=this.toColor(f,0),u.g=this.toColor(f,1),u.b=this.toColor(f,2),u.a=this.toColor(f,3)),u.hullLength=2*(r.hull||0),r.edges&&(u.edges=this.getIntArray(r,"edges")),u.width=(r.width||0)*o,u.height=(r.height||0)*o,u):null;if(v==t.AttachmentType.skinnedmesh){if(u=this.attachmentLoader.newSkinnedMeshAttachment(n,i,l),!u)return null;u.path=l;for(var k=this.getFloatArray(r,"uvs",1),h=this.getFloatArray(r,"vertices",1),c=[],a=[],s=0,w=h.length;w>s;)for(y=0|h[s++],a[a.length]=y,p=s+4*y;p>s;)a[a.length]=h[s],c[c.length]=h[s+1]*o,c[c.length]=h[s+2]*o,c[c.length]=h[s+3],s+=4;return u.bones=a,u.weights=c,u.triangles=this.getIntArray(r,"triangles"),u.regionUVs=k,u.updateUVs(),f=r.color,f&&(u.r=this.toColor(f,0),u.g=this.toColor(f,1),u.b=this.toColor(f,2),u.a=this.toColor(f,3)),u.hullLength=2*(r.hull||0),r.edges&&(u.edges=this.getIntArray(r,"edges")),u.width=(r.width||0)*o,u.height=(r.height||0)*o,u}if(v==t.AttachmentType.boundingbox){for(var b=this.attachmentLoader.newBoundingBoxAttachment(n,i),h=r.vertices,s=0,w=h.length;w>s;s++)b.vertices.push(h[s]*o);return b}throw"Unknown attachment type: "+v;},readAnimation:function(n,i,r){var a=[],c=0,ii=i.slots,b,pt,tt,ht,wt,l,s,kt,ni,u,ct,gt,fi,oi,hi,d,si,ti,ui,dt,f,bt,y,ei,ft,nt,yt,k,vt,ut,at,p,o,ot,v,it,st;for(b in ii)if(ii.hasOwnProperty(b)){d=ii[b],p=r.findSlotIndex(b);for(l in d)if(d.hasOwnProperty(l))if(s=d[l],"color"==l){u=new t.ColorTimeline(s.length),u.slotIndex=p;for(var h=0,e=0,w=s.length;w>e;e++){var f=s[e],lt=f.color,yi=this.toColor(lt,0),vi=this.toColor(lt,1),li=this.toColor(lt,2),ci=this.toColor(lt,3);u.setFrame(h,f.time,yi,vi,li,ci),this.readCurve(u,h,f),h++}a.push(u),c=Math.max(c,u.frames[5*u.getFrameCount()-5])}else{if("attachment"!=l)throw"Invalid timeline type for a slot: "+l+" ("+b+")";u=new t.AttachmentTimeline(s.length),u.slotIndex=p;for(var h=0,e=0,w=s.length;w>e;e++)f=s[e],u.setFrame(h++,f.time,f.name);a.push(u),c=Math.max(c,u.frames[u.getFrameCount()-1])}}pt=i.bones;for(tt in pt)if(pt.hasOwnProperty(tt)){if(ht=r.findBoneIndex(tt),-1==ht)throw"Bone not found: "+tt;wt=pt[tt];for(l in wt)if(wt.hasOwnProperty(l))if(s=wt[l],"rotate"==l){u=new t.RotateTimeline(s.length),u.boneIndex=ht;for(var h=0,e=0,w=s.length;w>e;e++)f=s[e],u.setFrame(h,f.time,f.angle),this.readCurve(u,h,f),h++;a.push(u),c=Math.max(c,u.frames[2*u.getFrameCount()-2])}else if("translate"==l||"scale"==l){kt=1,"scale"==l?u=new t.ScaleTimeline(s.length):(u=new t.TranslateTimeline(s.length),kt=this.scale),u.boneIndex=ht;for(var h=0,e=0,w=s.length;w>e;e++){var f=s[e],ni=(f.x||0)*kt,bi=(f.y||0)*kt;u.setFrame(h,f.time,ni,bi),this.readCurve(u,h,f),h++}a.push(u),c=Math.max(c,u.frames[3*u.getFrameCount()-3])}else{if("flipX"!=l&&"flipY"!=l)throw"Invalid timeline type for a bone: "+l+" ("+tt+")";ni="flipX"==l,u=ni?new t.FlipXTimeline(s.length):new t.FlipYTimeline(s.length),u.boneIndex=ht;for(var pi=ni?"x":"y",h=0,e=0,w=s.length;w>e;e++)f=s[e],u.setFrame(h,f.time,f[pi]||!1),h++;a.push(u),c=Math.max(c,u.frames[2*u.getFrameCount()-2])}}ct=i.ik;for(gt in ct)if(ct.hasOwnProperty(gt)){var wi=r.findIkConstraint(gt),s=ct[gt],u=new t.IkConstraintTimeline(s.length);u.ikConstraintIndex=r.ikConstraints.indexOf(wi);for(var h=0,e=0,w=s.length;w>e;e++){var f=s[e],ai=f.hasOwnProperty("mix")?f.mix:1,di=!f.hasOwnProperty("bendPositive")||f.bendPositive?1:-1;u.setFrame(h,f.time,ai,di),this.readCurve(u,h,f),h++}a.push(u),c=Math.max(c,u.frames[3*u.frameCount-3])}fi=i.ffd;for(oi in fi){hi=r.findSkin(oi),d=fi[oi];for(b in d){p=r.findSlotIndex(b),si=d[b];for(ti in si){var s=si[ti],u=new t.FfdTimeline(s.length),g=hi.getAttachment(p,ti);if(!g)throw"FFD attachment not found: "+ti;u.slotIndex=p,u.attachment=g,dt=g.type==t.AttachmentType.mesh,ui=dt?g.vertices.length:g.weights.length/3*2;for(var h=0,e=0,w=s.length;w>e;e++){if(f=s[e],f.vertices){if(bt=f.vertices,y=[],y.length=ui,ei=f.offset||0,ft=bt.length,1==this.scale)for(o=0;ft>o;o++)y[o+ei]=bt[o];else for(o=0;ft>o;o++)y[o+ei]=bt[o]*this.scale;if(dt)for(var ki=g.vertices,o=0,ft=y.length;ft>o;o++)y[o]+=ki[o]}else dt?y=g.vertices:(y=[],y.length=ui);u.setFrame(h,f.time,y),this.readCurve(u,h,f),h++}a[a.length]=u,c=Math.max(c,u.frames[u.frameCount-1])}}}if(nt=i.drawOrder,nt||(nt=i.draworder),nt){for(var u=new t.DrawOrderTimeline(nt.length),et=r.slots.length,h=0,e=0,w=nt.length;w>e;e++){if(yt=nt[e],k=null,yt.offsets){for(k=[],k.length=et,o=et-1;o>=0;o--)k[o]=-1;vt=yt.offsets,ut=[],ut.length=et-vt.length;for(var rt=0,ri=0,o=0,ft=vt.length;ft>o;o++){if(at=vt[o],p=r.findSlotIndex(at.slot),-1==p)throw"Slot not found: "+at.slot;for(;rt!=p;)ut[ri++]=rt++;k[rt+at.offset]=rt++}for(;et>rt;)ut[ri++]=rt++;for(o=et-1;o>=0;o--)-1==k[o]&&(k[o]=ut[--ri])}u.setFrame(h++,yt.time,k)}a.push(u),c=Math.max(c,u.frames[u.getFrameCount()-1])}if(ot=i.events,ot){for(var u=new t.EventTimeline(ot.length),h=0,e=0,w=ot.length;w>e;e++){if(v=ot[e],it=r.findEvent(v.name),!it)throw"Event not found: "+v.name;st=new t.Event(it),st.intValue=v.hasOwnProperty("int")?v.int:it.intValue,st.floatValue=v.hasOwnProperty("float")?v.float:it.floatValue,st.stringValue=v.hasOwnProperty("string")?v.string:it.stringValue,u.setFrame(h++,v.time,st)}a.push(u),c=Math.max(c,u.frames[u.getFrameCount()-1])}r.animations.push(new t.Animation(n,a,c))},readCurve:function(n,t,i){var r=i.curve;r?"stepped"==r?n.curves.setStepped(t):r instanceof Array&&n.curves.setCurve(t,r[0],r[1],r[2],r[3]):n.curves.setLinear(t)},toColor:function(n,t){if(8!=n.length)throw"Color hexidecimal length must be 8, recieved: "+n;return parseInt(n.substring(2*t,2*t+2),16)/255},getFloatArray:function(n,i,r){var f=n[i],e=new t.Float32Array(f.length),u=0,o=f.length;if(1==r)for(;o>u;u++)e[u]=f[u];else for(;o>u;u++)e[u]=f[u]*r;return e},getIntArray:function(n,i){for(var u=n[i],f=new t.Uint16Array(u.length),r=0,e=u.length;e>r;r++)f[r]=0|u[r];return f}},t.Atlas=function(n,i){var e,r,u,o,f,s,h,c,l,a;for(this.textureLoader=i,this.pages=[],this.regions=[],e=new t.AtlasReader(n),r=[],r.length=4,u=null;;){if(o=e.readLine(),null===o)break;(o=e.trim(o),o.length)?u?(f=new t.AtlasRegion,f.name=o,f.page=u,f.rotate="true"==e.readValue(),e.readTuple(r),s=parseInt(r[0]),h=parseInt(r[1]),e.readTuple(r),c=parseInt(r[0]),l=parseInt(r[1]),f.u=s/u.width,f.v=h/u.height,f.rotate?(f.u2=(s+l)/u.width,f.v2=(h+c)/u.height):(f.u2=(s+c)/u.width,f.v2=(h+l)/u.height),f.x=s,f.y=h,f.width=Math.abs(c),f.height=Math.abs(l),4==e.readTuple(r)&&(f.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==e.readTuple(r)&&(f.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],e.readTuple(r))),f.originalWidth=parseInt(r[0]),f.originalHeight=parseInt(r[1]),e.readTuple(r),f.offsetX=parseInt(r[0]),f.offsetY=parseInt(r[1]),f.index=parseInt(e.readValue()),this.regions.push(f)):(u=new t.AtlasPage,u.name=o,2==e.readTuple(r)&&(u.width=parseInt(r[0]),u.height=parseInt(r[1]),e.readTuple(r)),u.format=t.Atlas.Format[r[0]],e.readTuple(r),u.minFilter=t.Atlas.TextureFilter[r[0]],u.magFilter=t.Atlas.TextureFilter[r[1]],a=e.readValue(),u.uWrap=t.Atlas.TextureWrap.clampToEdge,u.vWrap=t.Atlas.TextureWrap.clampToEdge,"x"==a?u.uWrap=t.Atlas.TextureWrap.repeat:"y"==a?u.vWrap=t.Atlas.TextureWrap.repeat:"xy"==a&&(u.uWrap=u.vWrap=t.Atlas.TextureWrap.repeat),i.load(u,o,this),this.pages.push(u)):u=null}},t.Atlas.prototype={findRegion:function(n){for(var i=this.regions,t=0,r=i.length;r>t;t++)if(i[t].name==n)return i[t];return null},dispose:function(){for(var t=this.pages,n=0,i=t.length;i>n;n++)this.textureLoader.unload(t[n].rendererObject)},updateUVs:function(n){for(var t,r=this.regions,i=0,u=r.length;u>i;i++)t=r[i],t.page==n&&(t.u=t.x/n.width,t.v=t.y/n.height,t.rotate?(t.u2=(t.x+t.height)/n.width,t.v2=(t.y+t.width)/n.height):(t.u2=(t.x+t.width)/n.width,t.v2=(t.y+t.height)/n.height))}},t.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},t.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},t.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},t.AtlasPage=function(){},t.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},t.AtlasRegion=function(){},t.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},t.AtlasReader=function(n){this.lines=n.split(/\r\n|\r|\n/)},t.AtlasReader.prototype={index:0,trim:function(n){return n.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var n=this.readLine(),t=n.indexOf(":");if(-1==t)throw"Invalid line: "+n;return this.trim(n.substring(t+1))},readTuple:function(n){var r=this.readLine(),f=r.indexOf(":"),t,i,u;if(-1==f)throw"Invalid line: "+r;for(t=0,i=f+1;3>t;t++){if(u=r.indexOf(",",i),-1==u)break;n[t]=this.trim(r.substr(i,u-i)),i=u+1}return n[t]=this.trim(r.substring(i)),t+1}},t.AtlasAttachmentLoader=function(n){this.atlas=n},t.AtlasAttachmentLoader.prototype={newRegionAttachment:function(n,i,r){var u=this.atlas.findRegion(r),f;if(!u)throw"Region not found in atlas: "+r+" (region attachment: "+i+")";return f=new t.RegionAttachment(i),f.rendererObject=u,f.setUVs(u.u,u.v,u.u2,u.v2,u.rotate),f.regionOffsetX=u.offsetX,f.regionOffsetY=u.offsetY,f.regionWidth=u.width,f.regionHeight=u.height,f.regionOriginalWidth=u.originalWidth,f.regionOriginalHeight=u.originalHeight,f},newMeshAttachment:function(n,i,r){var f=this.atlas.findRegion(r),u;if(!f)throw"Region not found in atlas: "+r+" (mesh attachment: "+i+")";return u=new t.MeshAttachment(i),u.rendererObject=f,u.regionU=f.u,u.regionV=f.v,u.regionU2=f.u2,u.regionV2=f.v2,u.regionRotate=f.rotate,u.regionOffsetX=f.offsetX,u.regionOffsetY=f.offsetY,u.regionWidth=f.width,u.regionHeight=f.height,u.regionOriginalWidth=f.originalWidth,u.regionOriginalHeight=f.originalHeight,u},newSkinnedMeshAttachment:function(n,i,r){var f=this.atlas.findRegion(r),u;if(!f)throw"Region not found in atlas: "+r+" (skinned mesh attachment: "+i+")";return u=new t.SkinnedMeshAttachment(i),u.rendererObject=f,u.regionU=f.u,u.regionV=f.v,u.regionU2=f.u2,u.regionV2=f.v2,u.regionRotate=f.rotate,u.regionOffsetX=f.offsetX,u.regionOffsetY=f.offsetY,u.regionWidth=f.width,u.regionHeight=f.height,u.regionOriginalWidth=f.originalWidth,u.regionOriginalHeight=f.originalHeight,u},newBoundingBoxAttachment:function(n,i){return new t.BoundingBoxAttachment(i)}},t.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},t.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(n,i){var c=n.slots,v=c.length,y=n.x,p=n.y,l=this.boundingBoxes,e=this.polygonPool,o=this.polygons,a,r,h,u,f,s;for(l.length=0,r=0,a=o.length;a>r;r++)e.push(o[r]);for(o.length=0,r=0;v>r;r++)h=c[r],u=h.attachment,u.type==t.AttachmentType.boundingbox&&(l.push(u),s=e.length,s>0?(f=e[s-1],e.splice(s-1,1)):f=[],o.push(f),f.length=u.vertices.length,u.computeWorldVertices(y,p,h.bone,f));i&&this.aabbCompute()},aabbCompute:function(){for(var o,s,h=this.polygons,t=Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MIN_VALUE,u=Number.MIN_VALUE,f=0,c=h.length;c>f;f++)for(var e=h[f],n=0,l=e.length;l>n;n+=2)o=e[n],s=e[n+1],t=Math.min(t,o),i=Math.min(i,s),r=Math.max(r,o),u=Math.max(u,s);this.minX=t,this.minY=i,this.maxX=r,this.maxY=u},aabbContainsPoint:function(n,t){return n>=this.minX&&n<=this.maxX&&t>=this.minY&&t<=this.maxY},aabbIntersectsSegment:function(n,t,i,r){var e=this.minX,o=this.minY,s=this.maxX,h=this.maxY,c,u,f;return e>=n&&e>=i||o>=t&&o>=r||n>=s&&i>=s||t>=h&&r>=h?!1:(c=(r-t)/(i-n),u=c*(e-n)+t,u>o&&h>u)?!0:(u=c*(s-n)+t,u>o&&h>u)?!0:(f=(o-t)/c+n,f>e&&s>f?!0:(f=(h-t)/c+n,f>e&&s>f?!0:!1))},aabbIntersectsSkeleton:function(n){return this.minX<n.maxX&&this.maxX>n.minX&&this.minY<n.maxY&&this.maxY>n.minY},containsPoint:function(n,t){for(var r=this.polygons,i=0,u=r.length;u>i;i++)if(this.polygonContainsPoint(r[i],n,t))return this.boundingBoxes[i];return null},intersectsSegment:function(n,t,i,r){for(var f=this.polygons,u=0,e=f.length;e>u;u++)if(f[u].intersectsSegment(n,t,i,r))return this.boundingBoxes[u];return null},polygonContainsPoint:function(n,t,i){for(var u,f,s,h=n.length,e=h-2,o=!1,r=0;h>r;r+=2)u=n[r+1],f=n[e+1],(i>u&&f>=i||i>f&&u>=i)&&(s=n[r],s+(i-u)/(f-u)*(n[e]-s)<t&&(o=!o)),e=r;return o},polygonIntersectsSegment:function(n,t,i,r,u){for(var f,a=n.length,v=t-r,y=i-u,p=t*u-i*r,c=n[a-2],o=n[a-1],l=0;a>l;l+=2){var s=n[l],h=n[l+1],w=c*h-o*s,b=c-s,k=o-h,d=v*k-y*b,e=(p*b-v*w)/d;if((e>=c&&s>=e||e>=s&&c>=e)&&(e>=t&&r>=e||e>=r&&t>=e)&&(f=(p*k-y*w)/d,(f>=o&&h>=f||f>=h&&o>=f)&&(f>=i&&u>=f||f>=u&&i>=f)))return!0;c=s,o=h}return!1},getPolygon:function(n){var t=this.boundingBoxes.indexOf(n);return-1==t?null:this.polygons[t]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},t.Bone.yDown=!0,n.AnimCache={},n.SpineTextureLoader=function(t,i){n.EventTarget.call(this),this.basePath=t,this.crossorigin=i,this.loadingCount=0},n.SpineTextureLoader.prototype=n.SpineTextureLoader,n.SpineTextureLoader.prototype.load=function(t,i){if(t.rendererObject=n.BaseTexture.fromImage(this.basePath+"/"+i,this.crossorigin),!t.rendererObject.hasLoaded){var r=this;++r.loadingCount,t.rendererObject.addEventListener("loaded",function(){--r.loadingCount,r.dispatchEvent({type:"loadedBaseTexture",content:r})})}},n.SpineTextureLoader.prototype.unload=function(n){n.destroy(!0)},n.Spine=function(i){var f,h,c,o,s;if(n.DisplayObjectContainer.call(this),this.spineData=n.AnimCache[i],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+i);for(this.skeleton=new t.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new t.AnimationStateData(this.spineData),this.state=new t.AnimationState(this.stateData),this.slotContainers=[],f=0,h=this.skeleton.drawOrder.length;h>f;f++){var r=this.skeleton.drawOrder[f],u=r.attachment,e=new n.DisplayObjectContainer;if(this.slotContainers.push(e),this.addChild(e),u instanceof t.RegionAttachment)c=u.rendererObject.name,o=this.createSprite(r,u),r.currentSprite=o,r.currentSpriteName=c,e.addChild(o);else{if(!(u instanceof t.MeshAttachment))continue;s=this.createMesh(r,u),r.currentMesh=s,r.currentMeshName=u.name,e.addChild(s)}}this.autoUpdate=!0},n.Spine.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Spine.prototype.constructor=n.Spine,Object.defineProperty(n.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===n.Spine.prototype.autoUpdateTransform},set:function(t){this.updateTransform=t?n.Spine.prototype.autoUpdateTransform:n.DisplayObjectContainer.prototype.updateTransform}}),n.Spine.prototype.update=function(i){var c,o,a,e,s,v;this.state.update(i),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var l=this.skeleton.drawOrder,h=0,y=l.length;y>h;h++){var r=l[h],u=r.attachment,f=this.slotContainers[h];if(u){if(c=u.type,c===t.AttachmentType.region)u.rendererObject&&(!r.currentSpriteName||r.currentSpriteName!==u.name)&&(o=u.rendererObject.name,(void 0!==r.currentSprite&&(r.currentSprite.visible=!1),r.sprites=r.sprites||{},void 0!==r.sprites[o])?r.sprites[o].visible=!0:(a=this.createSprite(r,u),f.addChild(a)),r.currentSprite=r.sprites[o],r.currentSpriteName=o),e=r.bone,f.position.x=e.worldX+u.x*e.m00+u.y*e.m01,f.position.y=e.worldY+u.x*e.m10+u.y*e.m11,f.scale.x=e.worldScaleX,f.scale.y=e.worldScaleY,f.rotation=-(r.bone.worldRotation*t.degRad),r.currentSprite.tint=n.rgb2hex([r.r,r.g,r.b]);else{if(c!==t.AttachmentType.skinnedmesh){f.visible=!1;continue}r.currentMeshName&&r.currentMeshName===u.name||(s=u.name,(void 0!==r.currentMesh&&(r.currentMesh.visible=!1),r.meshes=r.meshes||{},void 0!==r.meshes[s])?r.meshes[s].visible=!0:(v=this.createMesh(r,u),f.addChild(v)),r.currentMesh=r.meshes[s],r.currentMeshName=s),u.computeWorldVertices(r.bone.skeleton.x,r.bone.skeleton.y,r,r.currentMesh.vertices)}f.visible=!0,f.alpha=r.a}else f.visible=!1}},n.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t),n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.Spine.prototype.createSprite=function(i,r){var u=r.rendererObject,e=u.page.rendererObject,o=new n.Rectangle(u.x,u.y,u.rotate?u.height:u.width,u.rotate?u.width:u.height),s=new n.Texture(e,o),f=new n.Sprite(s),h=u.rotate?.5*Math.PI:0;return f.scale.set(u.width/u.originalWidth,u.height/u.originalHeight),f.rotation=h-r.rotation*t.degRad,f.anchor.x=f.anchor.y=.5,i.sprites=i.sprites||{},i.sprites[u.name]=f,f},n.Spine.prototype.createMesh=function(t,i){var u=i.rendererObject,f=u.page.rendererObject,e=new n.Texture(f),r=new n.Strip(e);return r.drawMode=n.Strip.DrawModes.TRIANGLES,r.canvasPadding=1.5,r.vertices=new n.Float32Array(i.uvs.length),r.uvs=i.uvs,r.indices=i.triangles,t.meshes=t.meshes||{},t.meshes[i.name]=r,r},n.BaseTextureCache={},n.BaseTextureCacheIdGenerator=0,n.BaseTexture=function(t,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this._UID=n._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var r=this;this.source.onload=function(){r.hasLoaded=!0,r.width=r.source.naturalWidth||r.source.width,r.height=r.source.naturalHeight||r.source.height,r.dirty(),r.dispatchEvent({type:"loaded",content:r})},this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null,this._powerOf2=!1}},n.BaseTexture.prototype.constructor=n.BaseTexture,n.EventTarget.mixin(n.BaseTexture.prototype),n.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},n.BaseTexture.prototype.updateSourceImage=function(n){this.hasLoaded=!1,this.source.src=null,this.source.src=n},n.BaseTexture.prototype.dirty=function(){for(var n=0;n<this._glTextures.length;n++)this._dirty[n]=!0},n.BaseTexture.prototype.unloadFromGPU=function(){var t,i,r;for(this.dirty(),t=this._glTextures.length-1;t>=0;t--)i=this._glTextures[t],r=n.glContexts[t],r&&i&&r.deleteTexture(i);this._glTextures.length=0,this.dirty()},n.BaseTexture.fromImage=function(t,i,r){var u=n.BaseTextureCache[t],f;return(void 0===i&&-1===t.indexOf("data:")&&(i=!0),u)||(f=new Image,i&&(f.crossOrigin=""),f.src=t,u=new n.BaseTexture(f,r),u.imageUrl=t,n.BaseTextureCache[t]=u,-1!==t.indexOf(n.RETINA_PREFIX+".")&&(u.resolution=2)),u},n.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.BaseTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r},n.TextureCache={},n.FrameCache={},n.TextureCacheIdGenerator=0,n.Texture=function(t,i,r,u){this.noFrame=!1,i||(this.noFrame=!0,i=new n.Rectangle(0,0,1,1)),t instanceof n.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=i,this.trim=u,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||new n.Rectangle(0,0,1,1),t.hasLoaded?(this.noFrame&&(i=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(i)):t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},n.Texture.prototype.constructor=n.Texture,n.EventTarget.mixin(n.Texture.prototype),n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},n.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy(),this.valid=!1},n.Texture.prototype.setFrame=function(n){if(this.noFrame=!1,this.frame=n,this.width=n.width,this.height=n.height,this.crop.x=n.x,this.crop.y=n.y,this.crop.width=n.width,this.crop.height=n.height,!this.trim&&(n.x+n.width>this.baseTexture.width||n.y+n.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=n&&n.width&&n.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},n.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/r,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/r,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/r,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/r},n.Texture.fromImage=function(t,i,r){var u=n.TextureCache[t];return u||(u=new n.Texture(n.BaseTexture.fromImage(t,i,r)),n.TextureCache[t]=u),u},n.Texture.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i},n.Texture.fromCanvas=function(t,i){var r=n.BaseTexture.fromCanvas(t,i);return new n.Texture(r)},n.Texture.addTextureToCache=function(t,i){n.TextureCache[i]=t},n.Texture.removeTextureFromCache=function(t){var i=n.TextureCache[t];return delete n.TextureCache[t],delete n.BaseTextureCache[t],i},n.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},n.Texture.emptyTexture=new n.Texture(new n.BaseTexture),n.RenderTexture=function(t,i,r,u,f){if(this.width=t||100,this.height=i||100,this.resolution=f||1,this.frame=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new n.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=u||n.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,n.Texture.call(this,this.baseTexture,new n.Rectangle(0,0,this.width,this.height)),this.renderer=r||n.defaultRenderer,this.renderer.type===n.WEBGL_RENDERER){var e=this.renderer.gl;this.baseTexture._dirty[e.id]=!1,this.textureBuffer=new n.FilterTexture(e,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode),this.baseTexture._glTextures[e.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new n.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new n.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},n.RenderTexture.prototype=Object.create(n.Texture.prototype),n.RenderTexture.prototype.constructor=n.RenderTexture,n.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=this.frame.width=this.crop.width=t,this.height=this.frame.height=this.crop.height=i,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===n.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},n.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===n.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},n.RenderTexture.prototype.renderWebGL=function(n,t,i){var r,u;if(this.valid){r=n.worldTransform,r.identity(),r.translate(0,2*this.projection.y),t&&r.append(t),r.scale(1,-1),n.worldAlpha=1;for(var e=n.children,f=0,o=e.length;o>f;f++)e[f].updateTransform();u=this.renderer.gl,u.viewport(0,0,this.width*this.resolution,this.height*this.resolution),u.bindFramebuffer(u.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(n,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},n.RenderTexture.prototype.renderCanvas=function(n,t,i){var r,e,o;if(this.valid){r=n.worldTransform,r.identity(),t&&r.append(t),n.worldAlpha=1;for(var f=n.children,u=0,s=f.length;s>u;u++)f[u].updateTransform();i&&this.textureBuffer.clear(),e=this.textureBuffer.context,o=this.renderer.resolution,this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(n,e),this.renderer.resolution=o}},n.RenderTexture.prototype.getImage=function(){var n=new Image;return n.src=this.getBase64(),n},n.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},n.RenderTexture.prototype.getCanvas=function(){var u,f;if(this.renderer.type===n.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,r=this.textureBuffer.height,e=new Uint8Array(4*i*r);return t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,r,t.RGBA,t.UNSIGNED_BYTE,e),t.bindFramebuffer(t.FRAMEBUFFER,null),u=new n.CanvasBuffer(i,r),f=u.context.getImageData(0,0,i,r),f.data.set(e),u.context.putImageData(f,0,0),u.canvas}return this.textureBuffer.canvas},n.RenderTexture.tempMatrix=new n.Matrix,n.VideoTexture=function(t,i){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),n.BaseTexture.call(this,t,i),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),t.complete||(this._onCanPlay=this.onCanPlay.bind(this),t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this.onPlayStart.bind(this)),t.addEventListener("pause",this.onPlayStop.bind(this)))},n.VideoTexture.prototype=Object.create(n.BaseTexture.prototype),n.VideoTexture.constructor=n.VideoTexture,n.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},n.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},n.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},n.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))},n.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(n.BaseTextureCache[this.source._pixiId]=null,delete n.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),n.BaseTexture.prototype.destroy.call(this)},n.VideoTexture.baseTextureFromVideo=function(t,i){t._pixiId||(t._pixiId="video_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.VideoTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r},n.VideoTexture.textureFromVideo=function(t,i){var r=n.VideoTexture.baseTextureFromVideo(t,i);return new n.Texture(r)},n.VideoTexture.fromUrl=function(t,i){var r=document.createElement("video");return r.src=t,r.autoPlay=!0,r.play(),n.VideoTexture.textureFromVideo(r,i)},n.AssetLoader=function(t,i){this.assetURLs=t,this.crossorigin=i,this.loadersByType={jpg:n.ImageLoader,jpeg:n.ImageLoader,png:n.ImageLoader,gif:n.ImageLoader,webp:n.ImageLoader,json:n.JsonLoader,atlas:n.AtlasLoader,anim:n.SpineLoader,xml:n.BitmapFontLoader,fnt:n.BitmapFontLoader}},n.EventTarget.mixin(n.AssetLoader.prototype),n.AssetLoader.prototype.constructor=n.AssetLoader,n.AssetLoader.prototype._getDataType=function(n){var i="data:",f=n.slice(0,i.length).toLowerCase(),r,u,t;return f===i?(r=n.slice(i.length),u=r.indexOf(","),-1===u)?null:(t=r.slice(0,u).split(";")[0],t&&"text/plain"!==t.toLowerCase()?t.split("/").pop().toLowerCase():"txt"):null},n.AssetLoader.prototype.load=function(){function f(n){e.onAssetLoaded(n.data.content)}var e=this,t,i,n,r,u;for(this.loadCount=this.assetURLs.length,t=0;t<this.assetURLs.length;t++){if(i=this.assetURLs[t],n=this._getDataType(i),n||(n=i.split("?").shift().split(".").pop().toLowerCase()),r=this.loadersByType[n],!r)throw new Error(n+" is an unsupported file type");u=new r(i,this.crossorigin),u.on("loaded",f),u.load()}},n.AssetLoader.prototype.onAssetLoaded=function(n){this.loadCount--,this.emit("onProgress",{content:this,loader:n}),this.onProgress&&this.onProgress(n),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},n.JsonLoader=function(n,t){this.url=n,this.crossorigin=t,this.baseUrl=n.replace(/[^\/]*$/,""),this.loaded=!1},n.JsonLoader.prototype.constructor=n.JsonLoader,n.EventTarget.mixin(n.JsonLoader.prototype),n.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},n.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},n.JsonLoader.prototype.onJSONLoaded=function(){var r,u,o,s;if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames&&this.json.meta&&this.json.meta.image){var a=this.baseUrl+this.json.meta.image,e=new n.ImageLoader(a,this.crossorigin),f=this.json.frames;this.texture=e.texture.baseTexture,e.addEventListener("loaded",this.onLoaded.bind(this));for(r in f)if(u=f[r].frame,u){var c=new n.Rectangle(u.x,u.y,u.w,u.h),v=c.clone(),l=null;f[r].trimmed&&(o=f[r].sourceSize,s=f[r].spriteSourceSize,l=new n.Rectangle(s.x,s.y,o.w,o.h)),n.TextureCache[r]=new n.Texture(this.texture,c,v,l)}e.load()}else if(this.json.bones)if(n.AnimCache[this.url])this.onLoaded();else{var y=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",h=new n.JsonLoader(y,this.crossorigin),i=this;h.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();var r=new n.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),u=new t.Atlas(this.ajaxRequest.responseText,r),e=new t.AtlasAttachmentLoader(u),o=new t.SkeletonJson(e),f=o.readSkeletonData(i.json);n.AnimCache[i.url]=f,i.spine=f,i.spineAtlas=u,i.spineAtlasLoader=h,r.loadingCount>0?r.addEventListener("loadedBaseTexture",function(n){n.content.content.loadingCount<=0&&i.onLoaded()}):i.onLoaded()},h.load()}else this.onLoaded()},n.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},n.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},n.AtlasLoader=function(n,t){this.url=n,this.baseUrl=n.replace(/[^\/]*$/,""),this.crossorigin=t,this.loaded=!1},n.AtlasLoader.constructor=n.AtlasLoader,n.EventTarget.mixin(n.AtlasLoader.prototype),n.AtlasLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},n.AtlasLoader.prototype.onAtlasLoaded=function(){var e,h,a,s,o;if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};for(var u=this.ajaxRequest.responseText.split(/\r?\n/),f=-3,c=0,i=null,l=!1,t=0,r=0,v=this.onLoaded.bind(this),t=0;t<u.length;t++)(u[t]=u[t].replace(/^\s+|\s+$/g,""),""===u[t]&&(l=t+1),u[t].length>0)&&(l===t?(this.atlas.meta.image.push(u[t]),c=this.atlas.meta.image.length-1,this.atlas.frames.push({}),f=-3):f>0&&(f%7==1?(null!=i&&(this.atlas.frames[c][i.name]=i),i={name:u[t],frame:{}}):(e=u[t].split(" "),f%7==3?(i.frame.x=Number(e[1].replace(",","")),i.frame.y=Number(e[2])):f%7==4?(i.frame.w=Number(e[1].replace(",","")),i.frame.h=Number(e[2])):f%7==5&&(h={x:0,y:0,w:Number(e[1].replace(",","")),h:Number(e[2])},h.w>i.frame.w||h.h>i.frame.h?(i.trimmed=!0,i.realSize=h):i.trimmed=!1))),f++);if(null!=i&&(this.atlas.frames[c][i.name]=i),this.atlas.meta.image.length>0){for(this.images=[],r=0;r<this.atlas.meta.image.length;r++){a=this.baseUrl+this.atlas.meta.image[r],s=this.atlas.frames[r],this.images.push(new n.ImageLoader(a,this.crossorigin));for(t in s)o=s[t].frame,o&&(n.TextureCache[t]=new n.Texture(this.images[r].texture.baseTexture,{x:o.x,y:o.y,width:o.w,height:o.h}),s[t].trimmed&&(n.TextureCache[t].realSize=s[t].realSize,n.TextureCache[t].trim.x=0,n.TextureCache[t].trim.y=0))}for(this.currentImageId=0,r=0;r<this.images.length;r++)this.images[r].on("loaded",v);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},n.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},n.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},n.SpriteSheetLoader=function(n,t){this.url=n,this.crossorigin=t,this.baseUrl=n.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},n.SpriteSheetLoader.prototype.constructor=n.SpriteSheetLoader,n.EventTarget.mixin(n.SpriteSheetLoader.prototype),n.SpriteSheetLoader.prototype.load=function(){var t=this,i=new n.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(n){t.json=n.data.content.json,t.onLoaded()}),i.load()},n.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},n.ImageLoader=function(t,i){this.texture=n.Texture.fromImage(t,i),this.frames=[]},n.ImageLoader.prototype.constructor=n.ImageLoader,n.EventTarget.mixin(n.ImageLoader.prototype),n.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},n.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},n.ImageLoader.prototype.loadFramedSpriteSheet=function(t,i,r){var u,e;this.frames=[];for(var s=Math.floor(this.texture.width/t),h=Math.floor(this.texture.height/i),o=0,f=0;h>f;f++)for(u=0;s>u;u++,o++)e=new n.Texture(this.texture.baseTexture,{x:u*t,y:f*i,width:t,height:i}),this.frames.push(e),r&&(n.TextureCache[r+"-"+o]=e);this.load()},n.BitmapFontLoader=function(n,t){this.url=n,this.crossorigin=t,this.baseUrl=n.replace(/[^\/]*$/,""),this.texture=null},n.BitmapFontLoader.prototype.constructor=n.BitmapFontLoader,n.EventTarget.mixin(n.BitmapFontLoader.prototype),n.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},n.BitmapFontLoader.prototype.onXMLLoaded=function(){var r,h,o,c,e,i,t,s,a,f;if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){r=this.ajaxRequest.responseXML,(!r||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)&&("function"==typeof window.DOMParser?(h=new DOMParser,r=h.parseFromString(this.ajaxRequest.responseText,"text/xml")):(o=document.createElement("div"),o.innerHTML=this.ajaxRequest.responseText,r=o)),c=this.baseUrl+r.getElementsByTagName("page")[0].getAttribute("file"),e=new n.ImageLoader(c,this.crossorigin),this.texture=e.texture.baseTexture;var u={},l=r.getElementsByTagName("info")[0],v=r.getElementsByTagName("common")[0];for(u.font=l.getAttribute("face"),u.size=parseInt(l.getAttribute("size"),10),u.lineHeight=parseInt(v.getAttribute("lineHeight"),10),u.chars={},i=r.getElementsByTagName("char"),t=0;t<i.length;t++)s=parseInt(i[t].getAttribute("id"),10),a=new n.Rectangle(parseInt(i[t].getAttribute("x"),10),parseInt(i[t].getAttribute("y"),10),parseInt(i[t].getAttribute("width"),10),parseInt(i[t].getAttribute("height"),10)),u.chars[s]={xOffset:parseInt(i[t].getAttribute("xoffset"),10),yOffset:parseInt(i[t].getAttribute("yoffset"),10),xAdvance:parseInt(i[t].getAttribute("xadvance"),10),kerning:{},texture:n.TextureCache[s]=new n.Texture(this.texture,a)};for(f=r.getElementsByTagName("kerning"),t=0;t<f.length;t++){var y=parseInt(f[t].getAttribute("first"),10),p=parseInt(f[t].getAttribute("second"),10),w=parseInt(f[t].getAttribute("amount"),10);u.chars[p].kerning[y]=w}n.BitmapText.fonts[u.font]=u,e.addEventListener("loaded",this.onLoaded.bind(this)),e.load()}},n.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},n.SpineLoader=function(n,t){this.url=n,this.crossorigin=t,this.loaded=!1},n.SpineLoader.prototype.constructor=n.SpineLoader,n.EventTarget.mixin(n.SpineLoader.prototype),n.SpineLoader.prototype.load=function(){var t=this,i=new n.JsonLoader(this.url,this.crossorigin);i.on("loaded",function(n){t.json=n.data.content.json,t.onLoaded()}),i.load()},n.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},n.AbstractFilter=function(n,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=n||[]},n.AbstractFilter.prototype.constructor=n.AbstractFilter,n.AbstractFilter.prototype.syncUniforms=function(){for(var n=0,t=this.shaders.length;t>n;n++)this.shaders[n].dirty=!0},n.AlphaMaskFilter=function(t){n.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:t},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mask.value.x=t.width,this.uniforms.mask.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},n.AlphaMaskFilter.prototype=Object.create(n.AbstractFilter.prototype),n.AlphaMaskFilter.prototype.constructor=n.AlphaMaskFilter,n.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(n.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(n){this.uniforms.mask.value=n}}),n.ColorMatrixFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},n.ColorMatrixFilter.prototype=Object.create(n.AbstractFilter.prototype),n.ColorMatrixFilter.prototype.constructor=n.ColorMatrixFilter,Object.defineProperty(n.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(n){this.uniforms.matrix.value=n}}),n.GrayFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},n.GrayFilter.prototype=Object.create(n.AbstractFilter.prototype),n.GrayFilter.prototype.constructor=n.GrayFilter,Object.defineProperty(n.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(n){this.uniforms.gray.value=n}}),n.DisplacementFilter=function(t){n.AbstractFilter.call(this),this.passes=[this],t.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:t},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},t.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=t.width,this.uniforms.mapDimensions.value.y=t.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),t.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},n.DisplacementFilter.prototype=Object.create(n.AbstractFilter.prototype),n.DisplacementFilter.prototype.constructor=n.DisplacementFilter,n.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(n.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(n){this.uniforms.displacementMap.value=n}}),Object.defineProperty(n.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(n){this.uniforms.scale.value=n}}),Object.defineProperty(n.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(n){this.uniforms.offset.value=n}}),n.PixelateFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new n.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},n.PixelateFilter.prototype=Object.create(n.AbstractFilter.prototype),n.PixelateFilter.prototype.constructor=n.PixelateFilter,Object.defineProperty(n.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(n){this.dirty=!0,this.uniforms.pixelSize.value=n}}),n.BlurXFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},n.BlurXFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurXFilter.prototype.constructor=n.BlurXFilter,Object.defineProperty(n.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.dirty=!0,this.uniforms.blur.value=1/7e3*n}}),n.BlurYFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},n.BlurYFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurYFilter.prototype.constructor=n.BlurYFilter,Object.defineProperty(n.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}}),n.BlurFilter=function(){this.blurXFilter=new n.BlurXFilter,this.blurYFilter=new n.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},n.BlurFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurFilter.prototype.constructor=n.BlurFilter,Object.defineProperty(n.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(n){this.blurXFilter.blur=this.blurYFilter.blur=n}}),Object.defineProperty(n.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(n){this.blurXFilter.blur=n}}),Object.defineProperty(n.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(n){this.blurYFilter.blur=n}}),n.InvertFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},n.InvertFilter.prototype=Object.create(n.AbstractFilter.prototype),n.InvertFilter.prototype.constructor=n.InvertFilter,Object.defineProperty(n.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(n){this.uniforms.invert.value=n}}),n.SepiaFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},n.SepiaFilter.prototype=Object.create(n.AbstractFilter.prototype),n.SepiaFilter.prototype.constructor=n.SepiaFilter,Object.defineProperty(n.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(n){this.uniforms.sepia.value=n}}),n.TwistFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},n.TwistFilter.prototype=Object.create(n.AbstractFilter.prototype),n.TwistFilter.prototype.constructor=n.TwistFilter,Object.defineProperty(n.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(n){this.dirty=!0,this.uniforms.offset.value=n}}),Object.defineProperty(n.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(n){this.dirty=!0,this.uniforms.radius.value=n}}),Object.defineProperty(n.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(n){this.dirty=!0,this.uniforms.angle.value=n}}),n.ColorStepFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},n.ColorStepFilter.prototype=Object.create(n.AbstractFilter.prototype),n.ColorStepFilter.prototype.constructor=n.ColorStepFilter,Object.defineProperty(n.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(n){this.uniforms.step.value=n}}),n.DotScreenFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},n.DotScreenFilter.prototype=Object.create(n.AbstractFilter.prototype),n.DotScreenFilter.prototype.constructor=n.DotScreenFilter,Object.defineProperty(n.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(n){this.dirty=!0,this.uniforms.scale.value=n}}),Object.defineProperty(n.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(n){this.dirty=!0,this.uniforms.angle.value=n}}),n.CrossHatchFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},n.CrossHatchFilter.prototype=Object.create(n.AbstractFilter.prototype),n.CrossHatchFilter.prototype.constructor=n.CrossHatchFilter,Object.defineProperty(n.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(n){this.uniforms.blur.value=1/7e3*n}}),n.RGBSplitFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},n.RGBSplitFilter.prototype=Object.create(n.AbstractFilter.prototype),n.RGBSplitFilter.prototype.constructor=n.RGBSplitFilter,Object.defineProperty(n.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(n){this.uniforms.red.value=n}}),Object.defineProperty(n.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(n){this.uniforms.green.value=n}}),Object.defineProperty(n.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(n){this.uniforms.blue.value=n}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.PIXI=n):"undefined"!=typeof define&&define.amd?define(n):i.PIXI=n}).call(this)